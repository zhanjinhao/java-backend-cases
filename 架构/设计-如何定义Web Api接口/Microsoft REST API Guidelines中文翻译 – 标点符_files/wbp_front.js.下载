var dwqr_cnf={};!function(){for(var t=dwqr_opt.split("|"),e=["ver","dir","uid","api","pid"],n=0;n<e.length;n++)dwqr_cnf[e[n]]=t[n]}(),jQuery(document).ready(function(c){var t=function(t){var o,e=t||c(".wb-btn-like"),n=dwqr_cnf.uid||0,a=n?"WB_LOCAL_DATA_"+n:"WB_LOCAL_DATA_VISITOR",r=localStorage.getItem(a)?JSON.parse(localStorage.getItem(a)):{};r.post_liked_items||(r.post_liked_items=[]),o=r.post_liked_items,0<e.length&&e.each(function(){var t=c(this),e=dwqr_cnf.pid,n=t.data("count");e&&-1<o.indexOf(e)&&(t.addClass("active"),t.find(".like-count").eq(0).html("已赞("+n+")"))}),e.on("click",function(){var n=c(this),i=dwqr_cnf.pid,t=decodeURIComponent(dwqr_cnf.api);n.hasClass("active")||c.post(t,{action:"dwqr_ajax",do:"like",post_id:i},function(t){if(t){var e=1<t?999<t?"已赞("+parseInt(t/1e3)+"k+)":"已赞("+t+")":"已赞";n.find(".like-count").eq(0).html(e),n.addClass("active"),o.indexOf(i)<0&&o.push(i),localStorage.setItem(a,JSON.stringify(r))}})})},i={bySocial:function(t){c(".j-dwqr-social-btn").on("click",function(){wbui.open({title:"分享到...",content:wb_dwqr_share_html,className:"wbui-dwqr-share",success:function(){c(".wb-share-list .share-logo").on("click",function(){var t=c(this).attr("data-cmd"),e=encodeURI(document.title),n=c('meta[name="description"]').attr("content"),i=c(".wb-share-list").attr("data-cover"),o=c("[wb-share-url]").length?c("[wb-share-url]").attr("wb-share-url"):window.location.href;switch(i=i?encodeURI(i):"",t){case"weibo":window.open("https://service.weibo.com/share/share.php?url="+o+"&title="+e+"&pic="+i+"&searchPic=true","_blank");break;case"qzone":window.open("http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url="+o+"&title="+e+"&summary="+n+"&pics="+i,"_blank");break;case"qq":window.open("http://connect.qq.com/widget/shareqq/index.html?url="+o+"&title="+e+"&summary="+n+"&pics="+i,"_blank");break;case"weixin":wbui.open({title:"扫码打开",content:'<div class="qrbox" id="J_shareQrBox"><canvas width="200" id="J_shareQrImg"></canvas><p>用手机扫码即可打开该页。</p></div>',className:"wbui-qrbox",success:function(){new QRious({element:document.getElementById("J_shareQrImg"),level:"H",size:200,value:o})}})}})}})})},poster:function(){c(document).on("click",".j-dwqr-poster-btn",function(){var n=c("[wb-share-url]").length?c("[wb-share-url]").attr("wb-share-url"):window.location.href;wbui.open({type:"wbui-share-poster",content:'<div class="mobile-share-wrap"><div class="loading">分享图片生成中...</div></div><div class="poster-share-tips">请长按图片，将内容推荐给好友</div>',success:function(){c.ajax({url:decodeURIComponent(dwqr_cnf.api),data:{id:dwqr_cnf.pid,action:"dwqr_ajax",do:"wb_share_poster"},method:"POST",dataType:"json",timeout:6e4,success:function(t){t.callback=function(t){c(".mobile-share-wrap").html('<img src="'+t+'">'),/MicroMessenger/i.test(navigator.userAgent)&&c(".poster-share-tips").show()};var e=new QRious({value:n,padding:5,size:110});t.qrcode=e.toDataURL(),t.head&&t.logo&&t.qrcode?i.canvas(t):wbui.alert("生成分享图片失败<br>"+(t.head?"":"- 头图读取异常")+"<br>"+(t.logo?"":"- logo读取异常")+"<br>"+(t.qrcode?"":"- QRCode读取异常"),function(){wbui.closeAll()})},error:function(){wbui.alert("获取分享图片失败 - time out",function(){wbui.closeAll()})}})}})})},canvas:function(d){var s=document.createElement("canvas"),u=s.getContext("2d"),w=720,l=1100;s.width=w,s.height=1e4;switch(u.fillStyle="#fff",u.fillRect(0,0,s.width,s.height),poster_theme){case 1:var f={bgi:"theme_1.jpg",padding_left:60,padding_top:60,head_width:600,main_width:600,with_content:1,with_domain:0};e(function(){u.fillStyle="#fff",u.fillRect(40,40,640,1020),n(0,function(t){i(t,function(t){o(t,function(t){a(t,function(t){r(t,function(t,e){c(t,e)})})})})})});break;case 2:f={bgi:"theme_2.jpg",padding_left:60,padding_top:270,head_width:600,main_width:600,with_content:1,with_domain:0};var t=document.domain;e(function(){u.fillStyle="#fff",u.fillRect(40,f.padding_top-20,640,1080-f.padding_top),u.stroke(),u.fillStyle="#1FAFE9",u.textAlign="center",u.font="500 36px sans-serif",u.fillText(t,360,130,w),n(0,function(t){i(t,function(t){a(t,function(t){r(t,function(t,e){c(t,e)})})})})});break;case 3:f={bgi:"theme_3.png",padding_left:60,padding_top:200,head_width:600,main_width:600,with_content:1,with_domain:0};e(function(){n(0,function(t){i(t,function(t){r(800,function(t,e){c(t,e)})})})});break;default:f={padding_left:40,padding_top:0,head_width:w,main_width:640,with_content:1,with_domain:0};n(0,function(t){i(t,function(t){o(t,function(t){a(t,function(t){r(t,function(t,e){c(t,e)})})})})})}function e(t){var e=f.bgi;if(!e)return t&&t(),!1;var n=new Image;n.crossOrigin="anonymous",n.src=decodeURIComponent(dwqr_cnf.dir)+"assets/img/bgi/"+e,n.onerror=function(t){wbui.alert("生成分享图片失败 - 背景图读取异常",function(){wbui.closeAll()})},n.onload=function(){u.drawImage(this,0,0,w,n.height,0,0,w,l),t&&t()}}function n(s,l){var h=new Image;h.crossOrigin="anonymous",d.head.match(/^\/\//)&&(d.head=window.location.protocol+d.head),h.src=d.head,h.onerror=function(t){wbui.alert("生成分享图片失败 - 获取图头异常",function(){wbui.closeAll()})},h.onload=function(){var t=parseInt(2*f.head_width/3),e=parseInt(2*h.width/3),n=0,i=h.width,o=h.height,a=f.head_width,r=t,c=(w-f.head_width)/2,d=f.padding_top;h.height===h.width?(c=parseInt((f.head_width-t)/2)+(w-f.head_width)/2+20,r=a=t-40,d=40+f.padding_top):h.height>e?o=e:h.height<e&&(i=parseInt(3*o/2),n=parseInt((h.width-i)/2)),s+=t+f.padding_top,u.drawImage(this,n,0,i,o,c,d,a,r),l&&l(s)}}function i(t,e){u.stroke(),u.fillStyle="#666",u.textAlign="left",u.font="700 36px sans-serif",t+=80,t=h(jQuery("<div>").html(d.title).text(),f.padding_left,t,40,u),e&&e(t)}function o(t,e){u.textAlign="left",u.fillStyle="#333",u.font="300 28px sans-serif",t+=30,t=h(jQuery("<div>").html(d.excerpt).text(),f.padding_left,t,42,u),e&&e(t)}function a(t,e){t+=40,u.lineWidth=1,u.beginPath(),u.strokeStyle="#F0F0F0",u.moveTo(40,t),u.lineTo(680,t),u.stroke(),e&&e(t)}function r(n,i){var o=new Image;o.crossOrigin="anonymous",d.logo.match(/^\/\//)&&(d.logo=window.location.protocol+d.logo),o.src=d.logo,o.onerror=function(t){wbui.alert("生成分享图片失败 - 获取logo图片异常",function(){wbui.closeAll()})},o.onload=function(){n+=60;var t=400/o.width*o.height;t=100<t?100:t;var e=o.width/(o.height/t);t=(e=400<e?400:e)/o.width*o.height,u.drawImage(this,0,0,o.width,o.height,f.padding_left,n+(100-t)/2,e,t),i&&i(n,t)}}function c(o,a,r){var c=new Image;c.src=d.qrcode,c.onerror=function(t){wbui.alert("生成分享图片失败 - 二维码生成异常",function(){wbui.closeAll()})},c.onload=function(){var t=w-f.padding_left-100;u.drawImage(this,0,0,c.width,c.height,t,o,100,100/c.width*c.height);var e=100/c.width*c.height;o+=a<e?e:a,o=l;var n=u.getImageData(0,0,w,o);s.height=o,u.putImageData(n,0,0);var i=s.toDataURL("image/jpeg",1);d.callback(i),r&&r(o)}}function h(t,e,n,i,o){for(var a=0,r=0,c=0;c<t.length;c++)(a+=o.measureText(t[c]).width)>f.main_width-20&&(o.fillText(t.substring(r,c),e,n),n+=i,a=0,r=c),c==t.length-1&&(o.fillText(t.substring(r,c+1),e,n),n+=i);return n}}};c(".wb-btn-like").length&&t(),c(".j-dwqr-social-btn").length&&i.bySocial(),c(".wb-share-poster").length&&i.poster(),c(".j-dwqr-donate-btn").length&&c(".j-dwqr-donate-btn").on("click",function(){wbui.open({content:wb_dwqr_donate_html,className:"wbui-dwqr-donate",success:function(){var t=c(".wbui-dwqr-donate"),e=t.find(".tab-nav-item"),n=t.find(".tab-cont"),i="current",o=0;e.on("click",function(){o=c(this).index(),e.removeClass(i).eq(o).addClass(i),n.removeClass(i).eq(o).addClass(i)})}})})}),function(t,e){"use strict";var n=decodeURIComponent(dwqr_cnf.dir)+"/assets/wb_svg.html",i=dwqr_cnf.ver,o="WBP_DWQR_SVG_VER",a="WBP_DWQR_SVG_DATA";if(!e.createElementNS||!e.createElementNS("http://www.w3.org/2000/svg","svg").createSVGRect)return;function r(){e.body.insertAdjacentHTML("afterbegin",s)}function c(){e.body?r():e.addEventListener("DOMContentLoaded",r)}var d,s,l="localStorage"in t&&null!==t.localStorage;if(l&&localStorage.getItem(o)===i&&(s=localStorage.getItem(a)))return c();try{(d=new XMLHttpRequest).open("GET",n,!0),d.onload=function(){200<=d.status&&d.status<400&&(s=d.responseText,c(),l&&(localStorage.setItem(a,s),localStorage.setItem(o,i)))},d.send()}catch(t){}}(window,document);