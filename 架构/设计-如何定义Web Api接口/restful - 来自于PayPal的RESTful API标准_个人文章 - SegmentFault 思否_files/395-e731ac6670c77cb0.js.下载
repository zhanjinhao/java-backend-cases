"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[395],{70395:function(e,a,s){var n=s(4637),t=s(59496),i=s(95103),o=s(25311),c=s(85076),r=s(84303),l=s(2597),d=s(39461),m=s(17608),u=s(98817),f=s(70164),h=s(63372),x=s(8464),v=s(8746),k=s(58844),p=s(76689),b=s(46673),j=function(e){var a=e.mode,s=void 0===a?"default":a,h=e.id,j=e.actionData,N=void 0===j?{}:j,w=e.title,g=void 0===w?"":w,y=e.banner,Z=void 0===y?"":y,S=e.dispatch,C=e.showShare,L=void 0!==C&&C,B=e.source,_=e.showComment,I=void 0===_||_,D=e.isAuthor,A=void 0!==D&&D,F=e.sticky,M=void 0===F||F,q=e.style,E=void 0===q?{}:q,H=e.likeBtnSize,P=void 0===H?"lg":H,T=e.showLikeBtn,U=void 0===T||T,O=e.showHateBtn,R=void 0!==O&&O,K=e.showBookmarkBtn,z=void 0===K||K,$=e.showShareBtn,G=void 0===$||$,V=e.isNotHandle,W=void 0===V?{like:!1,hate:!1,haveAccess:!1}:V,X=e.isBaiduOxApp,J=void 0!==X&&X,Q=e.realViews,Y=void 0===Q?0:Q,ee=e.sessionUser,ae=N.isLiked,se=void 0!==ae&&ae,ne=N.votes,te=void 0===ne?0:ne,ie=N.bookmarks,oe=void 0===ie?0:ie,ce=N.isBookmarked,re=void 0!==ce&&ce,le=N.isHated,de=void 0!==le&&le,me=N.comments,ue=void 0===me?0:me,fe=(0,t.useState)(te),he=fe[0],xe=fe[1],ve=(0,t.useState)(de),ke=ve[0],pe=ve[1],be=(0,t.useState)(oe),je=be[0],Ne=be[1],we=(0,t.useState)(se),ge=we[0],ye=we[1],Ze=(0,t.useState)(re),Se=Ze[0],Ce=Ze[1],Le=(0,t.useState)(!1),Be=Le[0],_e=Le[1],Ie=(0,t.useState)(""),De=Ie[0],Ae=Ie[1],Fe=(0,t.useState)(""),Me=Fe[0],qe=Fe[1],Ee=(0,t.useState)(""),He=Ee[0],Pe=Ee[1],Te=(0,t.useState)(""),Ue=Te[0],Oe=Te[1],Re=(0,t.useState)(!1),Ke=Re[0],ze=Re[1],$e=(0,t.useState)(!1),Ge=$e[0],Ve=$e[1],We=(0,t.useRef)(),Xe=(0,t.useRef)(),Je=(0,t.useRef)();(0,t.useEffect)((function(){var e,a;(null===(e=window.navigator)||void 0===e||null===(a=e.canShare)||void 0===a?void 0:a.call(e,{text:g}))&&Ve(!0)}),[]),(0,t.useEffect)((function(){ye(se),Ce(re),xe(te),Ne(oe),pe(de)}),[se,re,te,oe,de]),(0,t.useEffect)((function(){var e="".concat(window.location.origin).concat(window.location.pathname,"?utm_medium=shareLink&utm_campaign=socialShare");Ae(ee?"".concat(e,"&share_user=").concat(ee.user.id):e),qe("\u3010".concat(g,"\u3011\u5206\u4eab\u81ea @segment_fault\uff0c\u4f20\u9001\u95e8\uff1a")),Pe("\u3010".concat(g,"\u3011\u5206\u4eab\u81ea @SegmentFault\uff0c\u4f20\u9001\u95e8\uff1a"))}),[De,ee]),(0,t.useEffect)((function(){if(De&&!Ue){var e=null===document||void 0===document?void 0:document.querySelector(".qrcode");f.toCanvas(e,De,{margin:0},(function(e,a){e&&console.error(e),Oe(a.toDataURL())}))}}),[Ue,De]);var Qe=function(){if((0,b.bg)())if(W.like)k.ZP.confirm({content:"\u4e0d\u80fd\u7ed9\u81ea\u5df1\u70b9\u8d5e"});else if(!A||"article"!==B&&"video"!==B)if("product-score"!==B||W.haveAccess){var e=ke?2:1;xe(ge?he-e:he+e),ye(!ge),pe(!1),S({type:"action/saveLike",payload:{id:h,votes:ge?he-e:he+e,isLiked:!ge,isHated:!1}}),(0,p.vLC)({id:h,type:B,is_like:ge?0:1}).catch((function(){xe(he),ye(ge),pe(ke),S({type:"action/saveLike",payload:{id:h,votes:he,isLiked:ge,isHated:ke}})}))}else S({type:"global/saveProductAuthModalState",payload:{isShow:!0,title:"\u70b9\u8d5e"}});else k.ZP.confirm({content:"\u4f60\u662f\u4f5c\u8005\uff0c\u65e0\u6cd5\u5bf9\u81ea\u5df1\u8fdb\u884c\u6b64\u64cd\u4f5c"})},Ye=function(){(0,b.bg)()&&_e(!0)},ea=(0,n.jsx)(i.Z,{id:"popover-basic",children:(0,n.jsx)(i.Z.Body,{children:"\u5982\u679c\u8be5\u5185\u5bb9\u6709\u53ef\u6539\u8fdb\u7684\u4f59\u5730\uff0c\u6b22\u8fce\u901a\u8fc7\u8bc4\u8bba\u7ed9\u4f5c\u8005\u5efa\u8bae\u3002"})}),aa=(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"text-center mt-2",style:{cursor:"auto"},children:[(0,n.jsx)("div",{className:"qr",children:(0,n.jsx)("img",{crossOrigin:"anonymous",src:Ue,width:"118",height:"118"})}),"\u626b\u4e00\u626b\u5206\u4eab"]}),(0,n.jsx)("div",{className:"dropdown-divider"}),(0,n.jsx)(o.Z.Item,{className:"p-0",onKeyDown:function(e){13===e.keyCode&&We.current.click()},children:(0,n.jsxs)(d.Z,{title:He,url:"".concat(De,"&utm_source=Weibo"),image:Z,ref:We,className:"btn w-100 ps-4 pe-4 pt-1 pb-1 text-start",children:[(0,n.jsx)("i",{className:"fab fa-weibo fa-fw"})," \u65b0\u6d6a\u5fae\u535a"]})}),(0,n.jsx)(o.Z.Item,{className:"p-0",onKeyDown:function(e){13===e.keyCode&&Xe.current.click()},children:(0,n.jsxs)(m.Z,{title:Me,url:"".concat(De,"&utm_source=Twitter"),ref:Xe,className:"btn w-100 ps-4 pe-4 pt-1 pb-1 text-start",children:[(0,n.jsx)("i",{className:"fab fa-twitter fa-fw"})," Twitter"]})}),(0,n.jsx)(o.Z.Item,{className:"p-0",onKeyDown:function(e){13===e.keyCode&&Je.current.click()},children:(0,n.jsxs)(u.Z,{title:Me,url:"".concat(De,"&utm_source=Facebook"),ref:Je,className:"btn w-100 ps-4 pe-4 pt-1 pb-1 text-start",children:[(0,n.jsx)("i",{className:"fab fa-facebook fa-fw"})," Facebook"]})})]});return(0,n.jsxs)(n.Fragment,{children:["default"===s&&(0,n.jsx)("div",{className:"sticky-wrap ".concat(M?"sticky-top":""," functional-area-left d-none d-xl-flex justify-content-center pt-5 ").concat("article"===B?"functional-area-left2":""),style:E,children:(0,n.jsxs)(c.Z,{vertical:!0,className:"align-items-center",children:[U&&(0,n.jsxs)(r.Z,{variant:"outline-primary",className:"func-btn mainLike  sflex-center shadow-sm rounded-circle main-".concat(P,"-Like ").concat(R?"mb-2":"mb-3"),active:ge,onClick:Qe,"aria-label":"\u70b9\u8d5e",children:[(0,n.jsx)("i",{className:"far fa-thumbs-up"}),"question"===B||"answer"===B||"product-score"===B?(0,n.jsx)("span",{className:"mainLikeNum ".concat(0!==he?"":"invisible"),children:he}):(0,n.jsx)("span",{className:"mainLikeNum ".concat(he>0?"":"invisible"),children:he})]}),R&&(0,n.jsx)(l.Z,{trigger:"click",placement:"right",show:Ke,overlay:ea,children:(0,n.jsx)(r.Z,{variant:"outline-secondary",className:"shadow-sm func-btn sflex-center rounded-circle main-".concat(P,"-Like main-hate mb-3"),active:ke,onClick:function(){if((0,b.bg)())if(W.hate)k.ZP.confirm({content:"\u4e0d\u80fd\u7ed9\u81ea\u5df1\u70b9\u8e29"});else if("product-score"!==B||W.haveAccess){var e=ge?2:1;ye(!1),xe(ke?he+e:he-e),S({type:"action/saveLike",payload:{id:h,votes:ke?he+e:he-e,isLiked:!1,isHated:!ke}}),(0,p.qne)({id:h,type:B,is_hate:ke?0:1}).catch((function(){pe(ke),ye(ge),xe(he),ze(ke),S({type:"action/saveLike",payload:{id:h,votes:he,isLiked:ge,isHated:ke}})}))}else S({type:"global/saveProductAuthModalState",payload:{isShow:!0,title:"\u70b9\u8e29"}})},onBlur:function(){return ze(!1)},"aria-label":"\u70b9\u8e29",children:(0,n.jsx)("i",{className:"far fa-thumbs-down fa-flip-horizontal"})})}),z&&(0,n.jsx)(r.Z,{variant:"outline-secondary",className:"func-btn sflex-center rounded-circle mb-2",onClick:Ye,active:Se,"aria-label":"\u6536\u85cf",children:(0,n.jsx)("i",{className:"far fa-bookmark"})}),I&&(0,n.jsx)("a",{className:"func-btn sflex-center btn btn-outline-secondary rounded-circle mb-2",href:"#comment-area","aria-label":"\u8bc4\u8bba",children:(0,n.jsx)("i",{className:"far fa-message-lines"})}),G&&(0,n.jsxs)(o.Z,{children:[(0,n.jsx)(o.Z.Toggle,{as:v.Z,className:"func-btn nav-tab-item  rounded-pill btn btn-outline-secondary sflex-center rounded-circle",id:"actions-toggle",children:(0,n.jsx)("i",{className:"far fa-share-nodes"})}),(0,n.jsx)(o.Z.Menu,{className:"dropdown-menu-down",show:L,children:aa})]})]})}),"btnGroup"===s&&(0,n.jsx)("div",{className:"functional-area-bottom text-center",children:(0,n.jsxs)(c.Z,{className:"btn-group like-group align-items-center",role:"group",children:[(0,n.jsxs)(r.Z,{className:"btn me-2 rounded",variant:"outline-primary",active:ge,onClick:Qe,children:[(0,n.jsx)("i",{className:"far fa-thumbs-up"}),(0,n.jsx)("span",{className:"ms-1",children:ge?"\u5df2\u8d5e":"\u8d5e"}),he>0&&(0,n.jsx)("span",{className:"mainLikeNum ms-1",children:he})]}),z&&(0,n.jsxs)(r.Z,{className:"btn me-2 rounded",variant:"outline-secondary",active:Se,onClick:Ye,children:[(0,n.jsx)("i",{className:"far fa-bookmark"}),(0,n.jsx)("span",{className:"ms-1",children:Se?"\u5df2\u6536\u85cf":"\u6536\u85cf"}),oe>0&&(0,n.jsx)("span",{className:"ms-1",children:oe})]}),!J&&(0,n.jsxs)(o.Z,{className:"bottom-share-wrap",children:[(0,n.jsx)(o.Z.Toggle,{as:v.Z,className:"nav-tab-item btn d-flex justify-content-center align-items-center",id:"share-bottom-toggle",children:(0,n.jsxs)(r.Z,{className:"btn rounded",variant:"outline-secondary",active:!1,children:[(0,n.jsx)("i",{className:"far fa-share-nodes"}),(0,n.jsx)("span",{className:"ms-1",children:"\u5206\u4eab"})]})}),(0,n.jsx)(o.Z.Menu,{className:"dropdown-menu-down",children:aa})]})]})}),"fixBottom"===s&&(0,n.jsxs)("div",{className:"w-100 fixed-bottom-action d-flex align-items-center ",children:["article"===B&&(0,n.jsxs)("a",{className:"text-center text-body w-25",onClick:Qe,children:[ge?(0,n.jsx)("i",{className:"fas fa-thumbs-up"}):(0,n.jsx)("i",{className:"far fa-thumbs-up"}),he>0&&(0,n.jsx)("span",{className:"mainLikeNum ms-1",children:he})]}),"question"===B&&(0,n.jsxs)("a",{className:"text-center text-body w-25",onClick:function(e){e.preventDefault()},children:[(0,n.jsx)("i",{className:"far fa-eye"}),Y>0&&(0,n.jsx)("span",{className:"mainLikeNum ms-1",children:Y})]}),(0,n.jsxs)("a",{className:"text-center text-body w-25",onClick:function(e){e.preventDefault(),Ye()},children:[Se?(0,n.jsx)("i",{className:"fas fa-bookmark"}):(0,n.jsx)("i",{className:"far fa-bookmark"}),oe>0&&(0,n.jsx)("span",{className:"mainLikeNum ms-1",children:oe})]}),(0,n.jsxs)("a",{className:"text-center text-body w-25",href:"#comment-area",children:[(0,n.jsx)("i",{className:"far fa-message-lines"}),ue>0&&(0,n.jsx)("span",{className:"mainLikeNum ms-1",children:ue})]}),!J&&Ge&&(0,n.jsx)("a",{className:"text-center text-body w-25",onClick:function(e){e.preventDefault(),navigator.share({title:g,text:g+"- SegmentFault \u601d\u5426\uff0c\u4f20\u9001\u95e8\uff1a",url:"".concat(window.location.origin).concat(window.location.pathname)})},children:(0,n.jsx)("i",{className:"far fa-share-nodes text-body"})}),!J&&!Ge&&(0,n.jsxs)(o.Z,{className:"bottom-share-wrap w-25 text-center ",children:[(0,n.jsx)(o.Z.Toggle,{as:"a",id:"share-bottom-toggle",children:(0,n.jsx)("i",{className:"far fa-share-nodes text-body"})}),(0,n.jsx)(o.Z.Menu,{className:"dropdown-menu-down",children:aa})]})]}),(0,n.jsx)(x.Z,{id:h,isShow:Be,setShowStatus:_e,setBookmarkedState:function(e){Ne(e?je+1:je-1),Ce(e),S({type:"action/saveBookmark",payload:{id:h,bookmarks:e?je+1:je-1,isBookmarked:e}})},source:B,isBookmarked:re}),(0,n.jsx)("canvas",{hidden:!0,className:"qrcode"})]})};a.Z=(0,h.$j)((function(e){var a=e.global;return{isBaiduOxApp:a.isBaiduOxApp,sessionUser:a.sessionUser}}))(t.memo(j))},8746:function(e,a,s){var n=s(4637),t=s(59496),i=function(e,a){var s=e.children,t=e.onClick,i=e.className,o=e.domType,c=void 0===o?"a":o;return"a"===c?(0,n.jsx)("a",{href:"###",className:i,ref:a,onClick:function(e){e.preventDefault(),t(e)},children:s}):"button"===c?(0,n.jsx)("button",{className:i,ref:a,onClick:function(e){e.preventDefault(),t(e)}}):(0,n.jsx)("div",{className:i,ref:a,onClick:function(e){e.preventDefault(),t(e)},children:s})};a.Z=t.forwardRef(i)},8464:function(e,a,s){var n=s(41520),t=s(7444),i=s(27835),o=s(53693),c=s(74697),r=s.n(c),l=s(4637),d=s(59496),m=s(85515),u=s(491),f=s(63372),h=s(94911),x=s(41707),v=s(76689),k=function(e){var a=e.id,s=e.setBookmarkedState,c=e.isShow,f=e.setShowStatus,k=e.sessionUser,p=e.source,b=void 0===p?"":p,j=e.isBookmarked,N=void 0!==j&&j,w=(0,d.useState)(!1),g=w[0],y=w[1],Z=(0,d.useState)([]),S=Z[0],C=Z[1],L=(0,d.useState)([]),B=L[0],_=L[1],I=(0,d.useState)({value:"",isInvalid:!1,errorMsg:""}),D=I[0],A=I[1],F=(0,d.useState)(""),M=F[0],q=F[1],E=(0,d.useState)(1),H=E[0],P=E[1];(0,d.useEffect)((function(){k&&c&&T()}),[c]);var T=function(){var e=(0,n.Z)(r().mark((function e(){var s;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,v.XxZ)({objectId:a});case 2:(s=e.sent)&&s.rows&&(C(s.rows),_(s.rows.filter((function(e){return e.is_bookmarked})).map((function(e){return e.id}))));case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),U=function(){var e=(0,n.Z)(r().mark((function e(){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!g){e.next=10;break}if(D.value){e.next=4;break}return A((0,i.Z)((0,t.Z)({},D),{isInvalid:!0,errorMsg:"\u540d\u79f0\u5fc5\u586b"})),e.abrupt("return");case 4:return e.next=6,(0,v.Tlc)({name:D.value,description:M,is_private:H}).catch((function(e){(null===e||void 0===e?void 0:e.isError)&&A((0,i.Z)((0,t.Z)({},D),{isInvalid:!0,errorMsg:e.name}))}));case 6:T(),y(!g),e.next=11;break;case 10:(0,v.vjt)({type:b,id:a,is_bookmark:0===B.length?0:1,archive_ids:B}).catch((function(){s(!1)})),N!==Boolean(B.length)&&s(!(0===B.length)),f(!1);case 11:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,l.jsx)(x.Z,{scrollable:!0,show:c,title:g?"\u521b\u5efa\u6536\u85cf\u5939":"\u6536\u85cf",onCancel:function(){f(!1),y(!1),A({value:"",isInvalid:!1,errorMsg:""}),q(""),P(1)},onOk:U,children:g?(0,l.jsxs)(h.Z,{className:"bookmarklist-form",id:"bookmarkArchives",onSubmit:U,children:[(0,l.jsxs)(m.Z,{controlId:"bookmark.archiveName",className:"mb-3",children:[(0,l.jsx)(u.Z.Label,{className:"required",children:"\u540d\u79f0"})," ",(0,l.jsx)(u.Z.Control,{type:"text",className:"form-control",value:D.value,onChange:function(e){return A((0,i.Z)((0,t.Z)({},D),{value:e.target.value}))},placeholder:"\u6700\u591a\u8f93\u516532\u4e2a\u5b57",maxLength:32,autoComplete:"off",required:!0,isInvalid:D.isInvalid}),(0,l.jsx)(u.Z.Control.Feedback,{type:"invalid",children:D.errorMsg})]}),(0,l.jsxs)(m.Z,{controlId:"bookmark.description",className:"mb-3",children:[(0,l.jsx)(u.Z.Label,{children:"\u63cf\u8ff0"})," ",(0,l.jsx)(u.Z.Control,{as:"textarea",value:M,onChange:function(e){return q(e.target.value)},placeholder:"\u6700\u591a\u8f93\u5165256\u4e2a\u5b57",maxLength:256})]}),(0,l.jsxs)("div",{className:"form-check",children:[(0,l.jsx)("input",{className:"form-check-input",type:"radio",name:"isPrivate",value:"1",onChange:function(){return P(1)},checked:1===H,id:"bookmark-private"}),(0,l.jsx)("label",{className:"form-check-label",htmlFor:"bookmark-private",children:"\u79c1\u5bc6\uff1a"}),(0,l.jsx)("span",{className:"text-secondary",children:"\u4ec5\u81ea\u5df1\u53ef\u89c1"})]}),(0,l.jsxs)("div",{className:"form-check",children:[(0,l.jsx)("input",{className:"form-check-input",type:"radio",name:"isPrivate",onChange:function(){return P(0)},checked:0===H,id:"bookmark-public"}),(0,l.jsx)("label",{className:"form-check-label",htmlFor:"bookmark-public",children:"\u516c\u5f00\uff1a"}),(0,l.jsx)("span",{className:"text-secondary",children:"\u516c\u5f00\u540e\u4e0d\u53ef\u518d\u8bbe\u7f6e\u4e3a\u79c1\u5bc6"})]})]}):(0,l.jsx)(h.Z,{onSubmit:U,children:(0,l.jsxs)("div",{className:"mb-3",children:[(0,l.jsx)("label",{className:"form-title",children:"\u6dfb\u52a0\u5230\u6536\u85cf\u5939\uff1a"}),null===S||void 0===S?void 0:S.map((function(e){return(0,l.jsxs)("div",{className:"form-check mb-2",children:[(0,l.jsx)("input",{className:"form-check-input",type:"checkbox",name:"bookmarkItem[]",id:e.id,value:e.id,onChange:function(){return function(e){e.is_bookmarked?_(B.filter((function(a){return a!==e.id}))):_((0,o.Z)(B).concat([e.id])),C(S.map((function(a){return e.id===a.id&&(a.is_bookmarked=e.is_bookmarked?0:1),a})))}(e)},checked:Boolean(e.is_bookmarked)}),(0,l.jsxs)("label",{className:"form-check-label",htmlFor:e.id,children:[e.name,Boolean(e.is_private)&&(0,l.jsx)("span",{className:"text-secondary",children:"\uff08\u79c1\u5bc6\uff09"})]})]},e.id)})),(0,l.jsx)("button",{className:"btn btn-link new-bookmark p-0",onClick:function(){return y(!0)},children:"+ \u521b\u5efa\u6536\u85cf\u5939"})]})})})};a.Z=(0,f.$j)((function(e){return{sessionUser:e.global.sessionUser}}))(d.memo(k))}}]);