"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6271],{86271:function(e,n,t){t.d(n,{Z:function(){return Ee}});var i=t(41520),s=t(6687),a=t(7444),r=t(27835),o=t(53693),c=t(74697),l=t.n(c),d=t(4637),m=t(2735),u=t.n(m),f=t(59496),p=t(48832),h=t(44430),x=t(24882),v=t(33202),j=t(32699),g=t(63372),y=t(58844),b=t(32099),N=t(491),Z=t(85515),C=t(84303),w=t(2597),k=t(95103),_=t(12778),S=t(48359),E=["\ud83d\ude00","\ud83d\ude01","\ud83e\udd23","\ud83d\ude02","\ud83d\ude04","\ud83d\ude05","\ud83d\ude06","\ud83d\ude11","\ud83d\ude12","\ud83d\ude44","\ud83e\udd14","\ud83d\ude33","\ud83d\ude1e","\ud83d\ude21","\ud83d\ude31","\ud83d\ude37","\ud83d\udc4d","\ud83d\udc4e","\ud83d\udc4a","\ud83d\udc4c","\ud83e\udd1d","\ud83d\ude35","\ud83e\udd19","\ud83e\udd2b","\ud83d\ude48","\ud83d\ude49","\ud83d\ude4a"],I=function(e){var n=e.onSelected;return(0,d.jsx)(w.Z,{trigger:"click",placement:"bottom",rootClose:!0,overlay:(0,d.jsx)(k.Z,{className:"p-3",children:(0,d.jsx)(_.Z,{children:E.map((function(e,t){return(0,d.jsx)(S.Z,{xs:2,children:(0,d.jsx)(C.Z,{variant:"link",className:"m-0 p-0 font-size-24 btn-no-border",onClick:function(){return n(e)},children:e})},t)}))})}),children:(0,d.jsx)("a",{href:"###",className:"me-3",onClick:function(e){e.preventDefault()},"aria-label":"\u63d0\u793a",tabIndex:-1,children:(0,d.jsx)("i",{className:"far fa-face-laugh text-secondary"})})},"bottom")},R=(0,d.jsx)(d.Fragment,{children:(0,d.jsx)(u(),{id:"b3e1b6a7c9b96113",children:""})}),F=function(e){return(0,d.jsxs)(d.Fragment,{children:[R,(0,d.jsx)(I,(0,a.Z)({},e))]})},D=function(e){var n=e.isChild,t=void 0!==n&&n,i=e.item,s=e.parentItem,o=e.onChangeOfComment,c=e.onComment,l=(0,f.useRef)(null);(0,f.useEffect)((function(){if(l.current&&((0,v.Z)(l.current),i.original_text)){var e=i.original_text.length;l.current.setSelectionRange(e,e)}}),[l]);var m=function(e){s?o((0,r.Z)((0,a.Z)({},i),{original_text:e}),s):o((0,r.Z)((0,a.Z)({},i),{original_text:e}))};return(0,d.jsxs)(N.Z,{className:"edit-form ".concat(t?"edit-reply-form":""),children:[(0,d.jsxs)(Z.Z,{className:"mb-3",children:[(0,d.jsx)(N.Z.Control,{as:"textarea",className:"comment-text",rows:1,ref:l,autoFocus:!0,value:i.original_text,size:"sm",onChange:function(e){m(e.target.value)},placeholder:"\u64b0\u5199\u8bc4\u8bba ...",isInvalid:i.isInvalid}),(0,d.jsx)(N.Z.Control.Feedback,{type:"invalid",children:i.errorMsg})]}),(0,d.jsxs)("div",{className:"my-3 d-flex align-items-center justify-content-end",children:[(0,d.jsx)(F,{onSelected:function(e){var n=l.current;if(n){var t=n.value,i=n.selectionStart,s=void 0===i?0:i,a=t.slice(0,s)+e+t.slice(s);m(a);var r=s+e.length;n.setSelectionRange(r,r),n.focus()}}}),(0,d.jsx)(C.Z,{variant:"outline-secondary",size:"sm",className:"me-2 edit-top-comment-cancel-btn cancelEdit",onClick:function(){s?o((0,r.Z)((0,a.Z)({},i),{isEdit:!1}),s):o((0,r.Z)((0,a.Z)({},i),{isEdit:!1}))},children:"\u53d6\u6d88"}),(0,d.jsx)(C.Z,{size:"sm",onClick:function(){return c({item:i,parentItem:s})},disabled:!i.original_text,children:"\u63d0\u4ea4"})]})]})},U=(0,d.jsx)(d.Fragment,{children:(0,d.jsx)(u(),{id:"fbbcc7eb8f14ecf0",children:".edit-form .comment-text{overflow:hidden;overflow-wrap:break-word;resize:none;min-height:31px}.edit-form.edit-reply-form .comment-text{overflow:hidden;overflow-wrap:break-word;resize:none;min-height:31px;height:29px}"})}),z=function(e){return(0,d.jsxs)(d.Fragment,{children:[U,(0,d.jsx)(D,(0,a.Z)({},e))]})},T=f.memo(z),q=t(13957),O=t(24533),V=t(81279),B=t(64033),M=t(25311),K=t(8746),L=t(76689),P=function(e){var n=e.element,t=e.children,i=e.pageUsers,s=(0,f.useState)([]),a=s[0],r=s[1],c=(0,f.useRef)(null),l=(0,f.useState)(""),m=l[0],u=l[1],p=(0,f.useState)([]),h=p[0],x=p[1],v=(0,f.useState)(0),g=v[0],y=v[1],N=(0,f.useState)(!1),Z=N[0],C=N[1];(0,f.useEffect)((function(){if(n)return n.addEventListener("input",w),function(){n.removeEventListener("input",w)}}),[n]),(0,f.useEffect)((function(){var e=i[window.location.pathname];x((0,j.uniqBy)(e?(0,o.Z)(e).concat((0,o.Z)(a)):(0,o.Z)(a),"id"))}),[i,a,m]);var w=function(){var e=n.value,t=n.selectionStart,i=void 0===t?0:t;if(e.indexOf("@")<0&&u(""),i){var s=e.substring(e.substring(0,i).lastIndexOf("@"),i);s.substring(s.lastIndexOf(" "),i).indexOf("@")<0||(u(s.substring(1)),s.substring(1)&&(Z||(C(!0),(0,L.LIC)().then((function(e){r(e)})))))}},k=function(e){var t=n.value,i=n.selectionStart,s=void 0===i?0:i;if(s){var a=t.substring(t.substring(0,s).lastIndexOf("@"),s),r="@".concat(null===e||void 0===e?void 0:e.name,"[").concat(null===e||void 0===e?void 0:e.slug,"] ");n.value="".concat(t.substring(0,t.substring(0,s).lastIndexOf("@"))).concat(r).concat(t.substring(s)),x([]),u("");var o=s+r.length-a.length;n.setSelectionRange(o,o),n.focus()}},_=m?h.filter((function(e){return 0===e.name.indexOf(m)||0===e.slug.indexOf(m)})):[];return(0,d.jsxs)(M.Z,{className:"mentions-wrap",show:_.length>0,onKeyDown:function(e){var n=e.keyCode;if(38===n&&g>0&&(e.preventDefault(),y(g-1)),40===n&&g<_.length-1&&(e.preventDefault(),y(g+1)),13===n&&g>-1&&g<=_.length-1){e.preventDefault();var t=_[g];k(t),y(0)}},children:[t,(0,d.jsx)(M.Z.Toggle,{as:K.Z,domType:"div",id:"mentions-toggle"}),(0,d.jsx)(M.Z.Menu,{className:_.length>0?"visabled":"hidden",ref:c,children:_.filter((function(e,n){return n<5})).map((function(e,n){return(0,d.jsxs)(M.Z.Item,{className:"".concat(g===n?"bg-gray-200":""),onClick:function(){return k(e)},children:[(0,d.jsx)(b.Z,{className:"me-2",src:e.avatar_url,width:24,height:24}),(0,d.jsx)("span",{className:"text-body me-1",children:e.name}),(0,d.jsxs)("small",{className:"text-secondary",children:["@",e.slug]})]},n)}))})]})},$=(0,d.jsx)(d.Fragment,{children:(0,d.jsx)(u(),{id:"d6a7c16d4796689",children:".mentions-wrap .dropdown-toggle::after{display:none}"})}),A=function(e){return(0,d.jsxs)(d.Fragment,{children:[$,(0,d.jsx)(P,(0,a.Z)({},e))]})},H=(0,g.$j)((function(e){return{pageUsers:e.global.pageUsers}}))(f.memo(A)),Y=!0,G=2,Q=600,W=["question","answer"],X=function(e){var n=e.item,t=e.parentItem,i=e.onChangeOfComment,s=e.onComment,o=e.className,c=e.onEditComment,l=e.defaultVisableTip,m=void 0!==l&&l,u=e.mode,p=W.includes(u)?'\u7ed9\u95ee\u7b54\u70b9\u8d5e\u5c31\u662f\u652f\u6301\uff0c\u8bf7\u52ff\u5728\u8bc4\u8bba\u91cc\u53d1\u5e03\u201c+1\u3001\u611f\u8c22\u201d\u7b49\u4fe1\u606f"':"\u64b0\u5199\u8bc4\u8bba \u2026",h=(0,f.useState)(!1),x=h[0],j=h[1],g=(0,f.useState)(m),y=g[0],b=g[1],C=(0,f.useRef)(null),w=(0,f.useState)({isInvalid:!1,msg:""}),k=w[0],_=w[1],S=(n||{}).commentVal,E=void 0===S?"":S;(0,f.useEffect)((function(){W.includes(u)&&j(E.length>280)}),[E]),(0,f.useEffect)((function(){m!==y&&b(m)}),[m]),(0,f.useEffect)((function(){if((null===C||void 0===C?void 0:C.current)&&((0,v.Z)(C.current),n.commentVal)){var e=n.commentVal.length;C.current.setSelectionRange(e,e)}}),[C]);var I=function(e){_(e)},R=function(e){t?i((0,r.Z)((0,a.Z)({},n),{commentVal:e}),t):i((0,r.Z)((0,a.Z)({},n),{commentVal:e}))};return(0,d.jsxs)(N.Z,{className:"card-body add-comment-form ".concat(o),onKeyDown:function(e){13===e.keyCode&&(e.ctrlKey||e.metaKey)&&Y&&(Y=!1,setTimeout((function(){Y=!0}),700),s({item:n,parentItem:t,callback:I}))},children:[(0,d.jsxs)(Z.Z,{className:"mb-3",children:[(0,d.jsxs)("small",{className:"text-secondary",children:["\u56de\u590d"," ",(0,d.jsxs)("a",{href:n.user.url,onClick:function(e){c(n,t||"",e)},children:[n.user.name," \xd7"]})]}),(0,d.jsx)(H,{element:C.current,children:(0,d.jsx)(N.Z.Control,{as:"textarea",value:n.commentVal,autoFocus:!0,ref:C,size:"sm",rows:1,onChange:function(e){R(e.target.value)},className:"form-control form-control-sm comment-reply mt-2",placeholder:p,isInvalid:k.isInvalid})}),(0,d.jsx)(q.Z,{target:C.current,show:y&&x,placement:"top",children:function(e){return(0,d.jsx)(O.Z,(0,r.Z)((0,a.Z)({className:"qa-tooltip"},e),{children:"\u4f60\u6b63\u5728\u8f93\u5165\u5927\u6bb5\u5185\u5bb9\uff0c\u5982\u679c\u662f\u56de\u7b54\u6216\u8865\u5145\u4fe1\u606f\uff0c\u8bf7\u76f4\u63a5\u7f16\u8f91\u539f\u6587"}))}}),(0,d.jsx)(N.Z.Control.Feedback,{type:"invalid",children:k.msg}),(0,d.jsx)(N.Z.Control.Feedback,{type:"invalid",children:k.msg})]}),(0,d.jsxs)("div",{className:"d-flex flex-md-row flex-column justify-content-md-between align-items-md-center",children:[(0,d.jsx)("small",{className:"text-secondary",children:"\u8bc4\u8bba\u7528\u4e8e\u6307\u51fa\u5b58\u5728\u7684\u95ee\u9898\uff0c\u63d0\u9192\u4f5c\u8005\u6f84\u6e05\u6539\u8fdb\uff0c\u8bf7\u52ff\u5728\u8bc4\u8bba\u91cc\u56de\u7b54\u6216\u8865\u5145\u4fe1\u606f"}),(0,d.jsxs)("div",{className:"d-flex align-items-center justify-content-end",children:[(0,d.jsx)("a",{href:"###",className:"me-3",onClick:function(e){e.preventDefault(),b(!y)},tabIndex:-1,children:(0,d.jsx)("i",{className:"far fa-circle-info text-secondary"})}),(0,d.jsx)(F,{onSelected:function(e){var n=C.current;if(n){var t=n.value,i=n.selectionStart,s=void 0===i?0:i,a=t.slice(0,s)+e+t.slice(s);R(a);var r=s+e.length;n.setSelectionRange(r,r),n.focus()}}}),(0,d.jsx)(B.Z,{size:"sm",className:"float-end",onClick:function(){return s({item:n,parentItem:t,callback:I})},disabled:!E||E.length<G||E.length>Q,children:"\u63d0\u4ea4\u8bc4\u8bba"})]})]}),(0,d.jsxs)(V.Z,{show:y,variant:"info",className:"mt-3 my-0 font-size-14",children:["\u8bc4\u8bba\u652f\u6301\u90e8\u5206 Markdown \u8bed\u6cd5\uff1a",(0,d.jsx)("code",{children:"**\u7c97\u4f53** _\u659c\u4f53_ [\u94fe\u63a5](http://example.com) `\u4ee3\u7801` - \u5217\u8868 > \u5f15\u7528"}),"\u3002\u4f60\u8fd8\u53ef\u4ee5\u4f7f\u7528 ",(0,d.jsx)("code",{children:"@ "}),"\u6765\u901a\u77e5\u5176\u4ed6\u7528\u6237\u3002"]})]})},J=f.memo(X),ee=t(46673),ne=!0,te=2,ie=600,se=function(e){var n=e.commentContent,t=e.isShowComment,i=e.inputRef,s=e.setCommentContent,o=e.onComment,c=e.sessionUser,l=e.defaultVisableTip,m=void 0!==l&&l,u=(0,f.useState)(n.length>280),h=u[0],x=u[1],v=(0,f.useState)(m),j=v[0],g=v[1],y=(0,f.useState)({isInvalid:!1,msg:""}),b=y[0],C=y[1];(0,f.useEffect)((function(){m!==j&&g(m)}),[m]),(0,f.useEffect)((function(){x(n.length>280)}),[n]),(0,f.useEffect)((function(){t&&i.current.focus()}),[t]);var w=function(e){C(e)};return(0,d.jsx)(p.Z,{className:"bg-light border-0 mt-2 ".concat(t?"":"hidden"),onKeyDown:function(e){13===e.keyCode&&(e.ctrlKey||e.metaKey)&&ne&&(ne=!1,setTimeout((function(){ne=!0}),700),o({item:"comment",callback:w}))},tabIndex:2,children:(0,d.jsxs)(p.Z.Body,{children:[(0,d.jsxs)("div",{className:"media-body",children:[(0,d.jsxs)(Z.Z,{className:"mb-3",children:[(0,d.jsx)(H,{element:i.current,children:(0,d.jsx)(N.Z.Control,{as:"textarea",rows:1,ref:i,value:n,size:"sm",onChange:function(e){s(e.target.value)},className:"comment-text",placeholder:"\u7ed9\u95ee\u7b54\u70b9\u8d5e\u5c31\u662f\u652f\u6301\uff0c\u8bf7\u52ff\u5728\u8bc4\u8bba\u91cc\u53d1\u5e03\u201c+1\u3001\u611f\u8c22\u201d\u7b49\u4fe1\u606f",onFocus:function(e){c||(e.preventDefault(),(0,ee.bg)(),i.current.blur())},isInvalid:b.isInvalid})}),(0,d.jsx)(q.Z,{target:i.current,show:t&&h,placement:"top",children:function(e){return(0,d.jsx)(O.Z,(0,r.Z)((0,a.Z)({className:"qa-tooltip"},e),{children:"\u4f60\u6b63\u5728\u8f93\u5165\u5927\u6bb5\u5185\u5bb9\uff0c\u5982\u679c\u662f\u56de\u7b54\u6216\u8865\u5145\u4fe1\u606f\uff0c\u8bf7\u76f4\u63a5\u7f16\u8f91\u539f\u6587"}))}}),(0,d.jsx)(N.Z.Control.Feedback,{type:"invalid",children:b.msg})]}),(0,d.jsxs)("div",{className:"d-flex flex-md-row flex-column justify-content-md-between align-items-md-center",children:[(0,d.jsx)("small",{className:"text-secondary",children:"\u8bc4\u8bba\u7528\u4e8e\u6307\u51fa\u5b58\u5728\u7684\u95ee\u9898\uff0c\u63d0\u9192\u4f5c\u8005\u6f84\u6e05\u6539\u8fdb\uff0c\u8bf7\u52ff\u5728\u8bc4\u8bba\u91cc\u56de\u7b54\u6216\u8865\u5145\u4fe1\u606f"}),(0,d.jsxs)("div",{className:"d-flex align-items-center justify-content-end",children:[(0,d.jsx)("a",{href:"###",className:"me-3",onClick:function(e){e.preventDefault(),g(!j)},"aria-label":"\u63d0\u793a",tabIndex:-1,children:(0,d.jsx)("i",{className:"far fa-circle-info text-secondary"})}),(0,d.jsx)(F,{onSelected:function(e){var n=i.current,t=n.value,a=n.selectionStart,r=void 0===a?0:a,o=t.slice(0,r)+e+t.slice(r);s(o);var c=r+e.length;n.setSelectionRange(c,c),n.focus()}}),(0,d.jsx)(B.Z,{size:"sm",className:"float-end",onClick:function(){return o({item:"comment",callback:w})},disabled:!n||n.length<te||n.length>ie,children:"\u63d0\u4ea4\u8bc4\u8bba"})]})]})]}),(0,d.jsxs)(V.Z,{show:j,variant:"info",className:"mt-3 my-0 font-size-14",children:["\u8bc4\u8bba\u652f\u6301\u90e8\u5206 Markdown \u8bed\u6cd5\uff1a",(0,d.jsx)("code",{children:"**\u7c97\u4f53** _\u659c\u4f53_ [\u94fe\u63a5](http://example.com) `\u4ee3\u7801` - \u5217\u8868 > \u5f15\u7528"}),"\u3002\u4f60\u8fd8\u53ef\u4ee5\u4f7f\u7528 ",(0,d.jsx)("code",{children:"@ "}),"\u6765\u901a\u77e5\u5176\u4ed6\u7528\u6237\u3002"]})]})})},ae=(0,d.jsx)(d.Fragment,{children:(0,d.jsx)(u(),{id:"2a897c3644246ea1",children:".qa-tooltip .tooltip-inner{max-width:408px!important}"})}),re=function(e){return(0,d.jsxs)(d.Fragment,{children:[ae,(0,d.jsx)(se,(0,a.Z)({},e))]})},oe=(0,g.$j)((function(e){return{sessionUser:e.global.sessionUser}}))(f.memo(re)),ce=t(85076),le=function(e){var n=e.allTotal,t=e.sort,i=e.setSort,s=e.aId;return(0,d.jsxs)(p.Z.Header,{className:"d-flex align-items-center justify-content-between bg-transparent",children:[(0,d.jsxs)("strong",{children:[n," \u6761\u8bc4\u8bba"]}),(0,d.jsxs)(ce.Z,{"aria-label":"Basic",children:[(0,d.jsx)(C.Z,{as:"a",href:"/a/".concat(s,"?sort=votes"),size:"sm",variant:"votes"===t?"secondary":"outline-secondary",onClick:function(e){e.preventDefault(),i("votes")},children:"\u5f97\u7968"}),(0,d.jsx)(C.Z,{as:"a",href:"/a/".concat(s,"?sort=newest"),size:"sm",variant:"newest"===t?"secondary":"outline-secondary",onClick:function(e){e.preventDefault(),i("newest")},children:"\u6700\u65b0"})]})]})},de=f.memo(le),me=!0,ue=function(e){var n,t=e.commentContent,i=e.inputRef,s=e.setCommentContent,a=e.onComment,r=e.sessionUser,o=e.defaultVisableTip,c=void 0!==o&&o,l=(0,f.useState)(c),m=l[0],u=l[1],p=(0,f.useState)({isInvalid:!1,msg:""}),h=p[0],x=p[1],v=function(e){x(e)};(0,f.useEffect)((function(){c!==m&&u(c)}),[c]);return(0,d.jsx)(d.Fragment,{children:(0,d.jsxs)("div",{className:"mb-4 media",onKeyDown:function(e){13===e.keyCode&&(e.ctrlKey||e.metaKey)&&me&&t&&(me=!1,setTimeout((function(){me=!0}),700),a({item:"comment",callback:v}))},tabIndex:1,children:[(0,d.jsx)(b.Z,{src:null===r||void 0===r||null===(n=r.user)||void 0===n?void 0:n.avatar_url,className:"me-3",width:"38",height:"38","aria-hidden":"true"}),(0,d.jsxs)("div",{className:"media-body",children:[(0,d.jsxs)(Z.Z,{className:"mb-3",children:[(0,d.jsx)(H,{element:i.current,children:(0,d.jsx)(N.Z.Control,{as:"textarea",rows:1,ref:i,value:t,onChange:function(e){s(e.target.value)},className:"comment-text",placeholder:"\u64b0\u5199\u8bc4\u8bba \u2026",onFocus:function(e){(0,ee.bg)()||(e.preventDefault(),i.current.blur())},"aria-label":"\u8bc4\u8bba",isInvalid:h.isInvalid})}),(0,d.jsx)(N.Z.Control.Feedback,{type:"invalid",children:h.msg})]}),(0,d.jsxs)("div",{className:"d-flex justify-content-end align-items-center",children:[(0,d.jsx)("a",{href:"###",className:"me-3",onClick:function(e){e.preventDefault(),u(!m)},"aria-label":"\u63d0\u793a",tabIndex:-1,children:(0,d.jsx)("i",{className:"far fa-circle-info text-secondary"})}),(0,d.jsx)(F,{onSelected:function(e){var n=i.current,t=n.value,a=n.selectionStart,r=void 0===a?0:a,o=t.slice(0,r)+e+t.slice(r);s(o);var c=r+e.length;n.setSelectionRange(c,c),n.focus()}}),(0,d.jsx)(B.Z,{className:"float-end",onClick:function(){return a({item:"comment",callback:v})},disabled:!t,children:"\u63d0\u4ea4\u8bc4\u8bba"})]}),(0,d.jsxs)(V.Z,{show:m,variant:"info",className:"mt-3 my-0 font-size-14",children:["\u8bc4\u8bba\u652f\u6301\u90e8\u5206 Markdown \u8bed\u6cd5\uff1a",(0,d.jsx)("code",{children:"**\u7c97\u4f53** _\u659c\u4f53_ [\u94fe\u63a5](http://example.com) `\u4ee3\u7801` - \u5217\u8868 > \u5f15\u7528"}),"\u3002\u4f60\u8fd8\u53ef\u4ee5\u4f7f\u7528 ",(0,d.jsx)("code",{children:"@ "}),"\u6765\u901a\u77e5\u5176\u4ed6\u7528\u6237\u3002"]})]})]})})},fe=(0,g.$j)((function(e){return{sessionUser:e.global.sessionUser}}))(f.memo(ue)),pe=t(47529),he=function(e){var n=e.total,t=e.page,i=e.getData,s=function(e){i(e),function(){var e=document.getElementById("comment-area").getBoundingClientRect().top+window.pageYOffset+-65;window.scrollTo({top:e})}()};return(0,d.jsx)("div",{className:"d-flex justify-content-center mt-4 mb-1",children:(0,d.jsxs)(pe.Z,{size:"sm",className:"mb-0",children:[(0,d.jsx)(pe.Z.Item,{disabled:1===t,onClick:function(){return s(t-1)},children:"\u4e0a\u4e00\u9875"}),(0,o.Z)(Array(Math.ceil(n/15))).map((function(){return 0})).map((function(e,n){return(0,d.jsx)(pe.Z.Item,{active:t===n+1,onClick:function(){return s(n+1)},children:n+1},"page".concat(n))})),(0,d.jsx)(pe.Z.Item,{disabled:t===(0,o.Z)(Array(Math.ceil(n/15))).map((function(){return 0})).length,onClick:function(){return s(t+1)},children:"\u4e0b\u4e00\u9875"})]})})},xe=(0,g.$j)((function(e){return{sessionUser:e.global.sessionUser}}))(f.memo(he)),ve=t(95901),je=function(e){var n,t,i=e.sessionUser,s=e.item,a=e.onEditComment,r=e.onEdit,o=e.onRemove,c=e.onReport,l=(0,f.useState)(s.is_liked),m=l[0],u=l[1],p=(0,f.useState)(s.votes),h=p[0],x=p[1],v=(null===(n=s.member_actions)||void 0===n?void 0:n.filter((function(e){return"edit"===e.action})).length)>0,j=(null===(t=s.member_actions)||void 0===t?void 0:t.filter((function(e){return"delete"===e.action})).length)>0;return(0,d.jsxs)("div",{className:"handle-bar font-size-14 d-flex justify-content-between",children:[(0,d.jsxs)("div",{children:[(0,d.jsxs)("a",{className:"text-secondary",href:"###",onClick:function(e){return function(e,n){n.preventDefault(),(0,ee.bg)()&&(0,L.arA)({id:e.id,is_like:e.is_liked?0:1}).then((function(){x(m?h-1:h+1),u(!m)}))}(s,e)},children:[(0,d.jsx)("span",{className:"mainLike-comment ".concat(m?"text-primary":""),children:(0,d.jsx)("i",{className:"fa-w-16 ".concat(m?"fas fa-thumbs-up":"far fa-thumbs-up"),style:{width:"1em"}})}),h>0&&(0,d.jsx)("span",{className:"mainLike-commentNum ms-1",children:h})]}),(0,d.jsx)("span",{className:"split-dot"}),(0,d.jsx)("a",{className:"text-secondary btn-comment",href:"###",onClick:function(e){a(s,"",e)},children:"\u56de\u590d"}),(0,d.jsx)("span",{className:"split-dot"}),(0,d.jsx)("span",{className:"text-secondary",children:(0,ve.dq)(s.created)}),(null===s||void 0===s?void 0:s.ip_address)&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("span",{className:"split-dot"}),(0,d.jsxs)("span",{className:"text-secondary",children:["\u6765\u81ea",s.ip_address]})]})]}),(0,d.jsxs)("div",{className:"control-area d-none",children:[i&&v&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("a",{className:"text-secondary edit",href:"###",onClick:function(e){e.preventDefault(),r(s)},children:"\u7f16\u8f91"}),(0,d.jsx)("span",{className:"split-dot"})]}),i&&j&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("a",{className:"text-secondary delete",href:"###",onClick:function(e){return o(s.id,e)},children:"\u5220\u9664"}),(0,d.jsx)("span",{className:"split-dot"})]}),i&&(0,d.jsx)("a",{className:"text-secondary comment-report",href:"###",onClick:function(e){return c(s,e)},children:"\u4e3e\u62a5"})]})]})},ge=(0,g.$j)((function(e){return{sessionUser:e.global.sessionUser}}))(f.memo(je)),ye=function(e){var n,t,i=e.sessionUser,s=e.item,a=e.subItem,r=e.onEditComment,o=e.onEdit,c=e.onRemove,l=e.onReport,m=(0,f.useState)(a.is_liked),u=m[0],p=m[1],h=(0,f.useState)(a.votes),x=h[0],v=h[1],j=(null===(n=a.member_actions)||void 0===n?void 0:n.filter((function(e){return"edit"===e.action})).length)>0,g=(null===(t=a.member_actions)||void 0===t?void 0:t.filter((function(e){return"delete"===e.action})).length)>0;return(0,d.jsxs)("div",{className:"handle-bar font-size-14 d-flex justify-content-between",children:[(0,d.jsxs)("div",{children:[(0,d.jsxs)("a",{className:"text-secondary",href:"###",onClick:function(e){return function(e,n){n.preventDefault(),(0,ee.bg)()&&(0,L.arA)({id:e.id,is_like:e.is_liked?0:1}).then((function(){v(u?x-1:x+1),p(!u)}))}(a,e)},children:[(0,d.jsx)("span",{className:"mainLike-comment ".concat(u?"text-primary":""),children:(0,d.jsx)("i",{className:"fa-w-16 ".concat(u?"fas fa-thumbs-up":"far fa-thumbs-up"),style:{width:"1em"}})}),x>0&&(0,d.jsx)("span",{className:"mainLike-commentNum ms-1",children:x})]}),(0,d.jsx)("span",{className:"split-dot"}),(0,d.jsx)("a",{className:"text-secondary btn-reply",href:"###",onClick:function(e){r(a,s,e)},children:"\u56de\u590d"}),(0,d.jsx)("span",{className:"split-dot"}),(0,d.jsx)("span",{className:"text-secondary",children:(0,ve.dq)(a.created)})]}),(0,d.jsxs)("div",{className:"comment-control-area d-none",children:[i&&j&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("a",{className:"text-secondary edit",href:"###",onClick:function(e){e.preventDefault(),o(a,s)},children:"\u7f16\u8f91"}),(0,d.jsx)("span",{className:"split-dot"})]}),i&&g&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("a",{className:"text-secondary delete",href:"###",onClick:function(e){return c(a.id,e)},children:"\u5220\u9664"}),(0,d.jsx)("span",{className:"split-dot"})]}),i&&(0,d.jsx)("a",{className:"text-secondary reply-report",href:"###",onClick:function(e){return l(a,e)},children:"\u4e3e\u62a5"})]})]})},be=(0,g.$j)((function(e){return{sessionUser:e.global.sessionUser}}))(f.memo(ye)),Ne=t(50597),Ze="",Ce=["question","answer"],we=15,ke=function(e){var n=e.id,t=e.mode,c=void 0===t?"article":t,m=e.isShowComment,u=void 0!==m&&m,N=e.setCommentState,Z=e.event_object,C=e.user,w=void 0===C?{}:C,k=e.isFetchComments,_=void 0===k||k,S=e.sessionUser,E=((null===S||void 0===S?void 0:S.user)||{}).rank,I=void 0===E?0:E,R=(0,f.useRef)(null),F=(0,f.useState)(""),D=F[0],U=F[1],z=(0,g.I0)(),q=(0,g.k6)().location.query,O=void 0===q?{}:q;R.current&&(R.current.value=D);var V=(0,f.useState)([]),B=V[0],M=V[1],K=(0,f.useState)({isShow:!1,id:""}),P=K[0],$=K[1],A=(0,f.useState)({page:1,init:!0}),H=A[0],Y=A[1],G=(0,f.useState)(0),Q=G[0],W=G[1],X=(0,f.useState)(0),ne=X[0],te=X[1],ie=(0,f.useState)("newest"===O.sort?"newest":"votes"),se=ie[0],ae=ie[1],re=(0,f.useState)(!1),ce=re[0],le=re[1],me=(0,f.useState)(!1),ue=me[0],pe=me[1],he=(0,f.useRef)({}),je=(0,f.useState)(!1),ye=je[0],ke=je[1];(0,f.useEffect)((function(){R.current&&(0,v.Z)(R.current)}),[R]),(0,f.useEffect)((function(){Y({page:1,init:!0})}),[n]),(0,f.useEffect)((function(){_?1===H.page&&!0===H.init&&Se():M([])}),[H,_]),(0,f.useEffect)((function(){ye?Y({page:1,init:!0}):ke(!0)}),[se]),(0,f.useEffect)((function(){ce&&(B.map((function(e){return e.hidden=!1,e})),M((0,j.orderBy)(B,["created"])))}),[ce]),(0,f.useEffect)((function(){if(!(0,j.isEmpty)(B)&&!(0,j.isEmpty)(Z)&&String(n)===String(Z.root.object_id)&&c===Z.root.type&&String(n)===String(Z.root.object_id)&&"comment"===Z.current.type){var e,t,i,s=(0,j.findIndex)(B,["id",Number((null===Z||void 0===Z||null===(e=Z.current)||void 0===e?void 0:e.object_id)||0)]);if(s<0)B.forEach((function(e){t=(0,o.Z)(t||[]).concat((0,o.Z)(e.replies||[]))})),s=(0,j.findIndex)(t,["id",Number((null===Z||void 0===Z||null===(i=Z.current)||void 0===i?void 0:i.object_id)||0)]);["question","answer"].includes(c)&&s>2&&(B.splice(s,1),M([Z.current.comment].concat((0,o.Z)(B)))),-1===s&&M([Z.current.comment].concat((0,o.Z)(B)))}}),[B,Z]),(0,f.useEffect)((function(){z({type:"global/pushPageUser",payload:{pathName:window.location.pathname,users:B.map((function(e){return null===e||void 0===e?void 0:e.user}))}}),"question"==c&&z({type:"action/saveComments",payload:{id:n,comments:"article"===c?ne:null===B||void 0===B?void 0:B.length}})}),[B]);var _e=function(e){var t=e.item,i=e.parentItem,s=e.callback;return new Promise((function(e,l){if((0,ee.bg)()){var d,m,u={};if(i)u={reply_comment_id:i.id,reply_user_id:null===(d=t.user)||void 0===d?void 0:d.id};else if(null===t||void 0===t?void 0:t.isReply)u={reply_comment_id:t.reply_comment_id||t.id,reply_user_id:null===(m=t.user)||void 0===m?void 0:m.id};t.id&&!t.isReply&&t.isEdit?(0,L.uAg)((0,r.Z)((0,a.Z)({id:t.id,object_id:n},u),{text:null===t||void 0===t?void 0:t.original_text})).then((function(e){M(i?B.map((function(n){return(null===n||void 0===n?void 0:n.id)===i.id&&(null===n||void 0===n||n.replies.forEach((function(n){n.id===e.id&&(n.isEdit=!1,n.parsed_text=e.parsed_text)}))),n})):B.map((function(n){return n.id===e.id&&(n.parsed_text=null===e||void 0===e?void 0:e.parsed_text,n.isEdit=!1),n}))),"function"===typeof N&&N(!1)})).finally((function(){e(!0)})):(0,L.UI8)((0,r.Z)((0,a.Z)({object_id:n},u),{text:(null===t||void 0===t?void 0:t.commentVal)||D})).then((function(e){if("function"===typeof s&&s({isInvalid:!1,msg:""}),"string"===typeof t?U(""):M(B.map((function(e){return i?e.id===i.id&&e.replies.forEach((function(e){e.id===t.id&&(e.isReply=!1)})):e.id===t.id&&(e.isReply=!1,e.commentVal=""),e}))),"article"===c&&"string"!==typeof t)M(B.map((function(n){if(i){if(n.id===i.id){var s=(0,j.findIndex)(n.replies,{id:t.id});n.replies.splice(s+1,0,e.comment)}}else n.id===t.id&&((0,j.isEmpty)(n.replies)?n.replies=[e.comment]:n.replies.unshift(e.comment));return n})));else if("string"!==typeof t){var n=(0,j.findIndex)(B,{id:t.id});B.splice(n+1,0,e.comment),M(B)}else M([e.comment].concat((0,o.Z)(B)));"function"===typeof N&&N(!1)})).catch((function(e){(null===e||void 0===e?void 0:e.isError)&&"function"===typeof s&&s({isInvalid:!0,msg:e.reply_comment_id||e.text})})).finally((function(){e(!0)}))}else l(!1)}))},Se=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.commentId,i=void 0===t?"":t,o=e.commentPage,l=void 0===o?1:o,d=l;i?H[i]?(H[i].page+=1,Y((0,r.Z)((0,a.Z)({},H),{init:!1})),d=H[i].page):Y((0,r.Z)((0,a.Z)({},H,(0,s.Z)({},i,{page:1})),{init:!1})):Y((0,r.Z)((0,a.Z)({},H),{page:l,init:!1})),(0,L.liG)({objectId:n,commentId:i,page:d,sort:"newest"===se?"newest":"votes",is_direct:"article"===c?0:1}).then((function(e){(0,j.isEmpty)(null===e||void 0===e?void 0:e.comments)||Ee({commentId:i,res:e,page:d})}))},Ee=function(e){var t=e.commentId,i=e.res,s=e.page;if(t){var a=B.map((function(e){return e.id===t&&(e.replies=(0,j.orderBy)(1===s?i.comments:(0,o.Z)(e.replies).concat((0,o.Z)(i.comments)),["created"])),e}));M((0,j.uniqBy)(a,"id")||[])}else if(1===s&&(W(i.total),te(i.all_total),z({type:"action/saveComments",payload:{id:n,comments:i.all_total}})),"article"===c)M((0,j.uniqBy)(i.comments,"id"));else{var r=1===s?i.comments:(0,o.Z)(B).concat((0,o.Z)(i.comments));r=!ce&&Ce.includes(c)?(0,j.orderBy)(r,["votes"],["desc"]).map((function(e,n){return e.hidden=n>2,e})):(0,j.orderBy)((0,j.uniqBy)(r,"id"),["created"]),M(r)}},Ie=function(e,n,t){var i;t.preventDefault(),i=n?B.map((function(t){return t.id===n.id&&(t.replies=t.replies.map((function(n){return n.id===e.id&&(n.isReply=!n.isReply,n.isEdit=!1),n}))),t})):B.map((function(n){return n.id===e.id&&(n.isReply=!n.isReply,n.isEdit=!1),n})),M(i)},Re=function(e,n){var t;t="object"===typeof n?B.map((function(t){return t.id===(null===n||void 0===n?void 0:n.id)&&(t.replies=t.replies.map((function(n){return n.id===e.id&&(n=e),n}))),t})):B.map((function(n){return n.id===e.id&&(n=e),n})),M(t)},Fe=function(e,n){if(n.preventDefault(),"sf_app"===(0,ve.Xf)())return(0,Ne.Z)().send("report",{id:e.id}),!1;$({id:e.id,isShow:!0})},De=function(e,n){var t;t=n?B.map((function(t){return t.id===n.id&&(t.replies=t.replies.map((function(n){return n.id===e.id&&(n.isEdit=!n.isEdit,n.isReply=!1),n}))),t})):B.map((function(n){return n.id===e.id&&(n.isEdit=!n.isEdit,n.isReply=!1),n})),M(t)},Ue=function(e,n){n.preventDefault(),y.ZP.confirm({title:"\u5220\u9664\u8bc4\u8bba",content:"\u786e\u5b9a\u8981\u5220\u9664\u8be5\u8bc4\u8bba\u5417",onSuccess:(0,i.Z)(l().mark((function n(){return l().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,(0,L.YFy)(e);case 2:Se();case 3:case"end":return n.stop()}}),n)})))})};(0,f.useEffect)((function(){if(!ue&&!(0,j.isEmpty)(he.current)&&Ze&&ze(Ze)){var e=he.current[Ze];e&&(0,ve.SM)(e),pe(!0)}}));var ze=(0,f.useCallback)((function(e){var t=(0,ve.PQ)({eventObj:Z,id:e,type:"comment",parentId:n});return t&&(Ze=e),t}),[Z]),Te=Q-(ce?null===H||void 0===H?void 0:H.page:0)*we,qe=B.filter((function(e){return!(null===e||void 0===e?void 0:e.hidden)}));return(0,d.jsxs)("div",{children:[("question"===c||"answer"===c)&&(0,d.jsx)(oe,{defaultVisableTip:I<50,commentContent:D,isShowComment:u,inputRef:R,setCommentContent:U,onComment:_e}),(0,d.jsxs)(p.Z,{id:"comment-area",className:"comment-wrap ".concat("article"===c?"":0===B.length?"hidden":"bg-light border-0 mt-2"),children:["article"===c&&(0,d.jsx)(de,{allTotal:ne,sort:se,setSort:ae,aId:n}),(0,d.jsxs)(p.Z.Body,{className:"article"===c?"":"p-3",children:["article"===c&&(0,d.jsx)(fe,{defaultVisableTip:I<50,commentContent:D,inputRef:R,setCommentContent:U,onComment:_e}),(0,d.jsx)("div",{className:"comment-body-wrap ".concat(B.filter((function(e){return!e.hidden})).length<1&&"d-none"),children:qe.map((function(e,t){var i,s,a,r,o,l,m,u,f=e.parsed_text,v=e.reply_user;return(0,j.isEmpty)(v)||f.includes('<a href="'.concat(v.url,'">@').concat(v.name,"</a>"))||(f=f.replace(/^<p>/,'<p><a href="'.concat(v.url,'">@').concat(v.name,"</a> "))),(0,d.jsxs)("div",{ref:function(n){return he.current[e.id]=n},className:"mb-r media d-flex align-items-start ".concat(qe.length!==t+1&&("article"===c?"mb-4":"mb-3")),children:["article"===c&&(0,d.jsx)(b.Z,{className:"d-block me-3",width:"38",height:"38",src:null===(i=e.user)||void 0===i?void 0:i.avatar_url,alt:""}),(0,d.jsxs)("div",{className:"w-0 media-body ".concat(ze(e.id)?"scroll-warning":""),children:[(0,d.jsxs)("div",{className:"commentUnit ".concat("question"===c||"answer"===c?"font-size-14":""),children:[(0,d.jsxs)("div",{className:"mb-1",children:[(0,d.jsxs)("a",{className:"d-uname",href:null===(s=e.user)||void 0===s?void 0:s.url,target:"_blank",children:[(0,d.jsx)("strong",{children:null===(a=e.user)||void 0===a?void 0:a.name}),"article"===c&&(null===(r=e.user)||void 0===r?void 0:r.id)===(null===w||void 0===w?void 0:w.id)&&(0,d.jsx)("span",{className:"text-secondary",children:"\uff08\u4f5c\u8005\uff09"})]}),"\uff1a",!e.isEdit&&(0,d.jsx)("div",{className:"parsedText fmt",dangerouslySetInnerHTML:{__html:f}})]}),e.isEdit&&(0,d.jsx)(T,{onChangeOfComment:Re,item:e,onComment:_e}),(0,d.jsx)(ge,{item:e,onEditComment:Ie,onEdit:De,onRemove:Ue,onReport:Fe}),e.isReply&&(0,d.jsx)(p.Z,{className:"bg-light border-0 mt-2",children:(0,d.jsx)(J,{defaultVisableTip:I<50,id:n,className:"".concat("question"===c||"answer"==c?"p-0":"p-3"),mode:c,onChangeOfComment:Re,item:e,onComment:_e,onEditComment:Ie})})]}),(0,d.jsx)("div",{className:"replies ".concat((0,j.isEmpty)(e.replies)?"hidden":""),children:(0,d.jsx)(p.Z,{className:"bg-light border-0 mt-2",children:(0,d.jsxs)(p.Z.Body,{className:"p-3",children:[(0,d.jsx)(h.Z,{className:"reply-list",children:null===(o=e.replies)||void 0===o?void 0:o.map((function(t,i){var s,a,r,o=t.parsed_text,l=t.reply_user;return(0,j.isEmpty)(l)||o.includes('<a href="'.concat(l.url,'">@').concat(l.name,"</a>"))||(o=o.replace(/^<p>/,'<p><a href="'.concat(l.url,'">@').concat(l.name,"</a> "))),(0,d.jsxs)(x.Z,{ref:function(e){return he.current[t.id]=e},className:"p-0 border-0 commentUnit ".concat(e.replies.length!==i+1&&"mb-3"," ").concat(ze(t.id)?"scroll-warning":""," "),children:[(0,d.jsxs)("div",{className:"font-size-14 mb-1",children:[(0,d.jsxs)("a",{className:"d-uname",href:null===(s=t.user)||void 0===s?void 0:s.url,target:"_blank",children:[(0,d.jsx)("strong",{children:null===(a=t.user)||void 0===a?void 0:a.name}),"article"===c&&(null===(r=t.user)||void 0===r?void 0:r.id)===(null===w||void 0===w?void 0:w.id)&&(0,d.jsx)("span",{className:"text-secondary",children:"\uff08\u4f5c\u8005\uff09"})]}),"\uff1a",!t.isEdit&&(0,d.jsx)("div",{className:"parsedText fmt",dangerouslySetInnerHTML:{__html:o}})]}),t.isEdit&&(0,d.jsx)(T,{isChild:!0,onChangeOfComment:Re,item:t,parentItem:e,onComment:_e}),(0,d.jsx)(be,{item:e,subItem:t,onEditComment:Ie,onEdit:De,onRemove:Ue,onReport:Fe}),t.isReply&&(0,d.jsx)(p.Z,{className:"bg-light border-0 mt-2",children:(0,d.jsx)(J,{defaultVisableTip:I<50,id:n,onChangeOfComment:Re,item:t,onComment:_e,parentItem:e,className:"p-0",onEditComment:Ie})})]},t.id)}))}),e.replies&&e.replies_total>e.replies.length&&e.replies_total-((null===(l=H[e.id])||void 0===l?void 0:l.page)||0)*we>0&&(0,d.jsx)("div",{className:"font-size-14 d-flex mt-3",children:(0,d.jsx)("a",{className:"text-secondary next-page-btn",href:"###",onClick:function(n){n.preventDefault(),Se({commentId:e.id})},children:e.replies_total<we?"\u5171 ".concat(e.replies_total," \u6761\u56de\u590d"):"\u66f4\u591a ".concat(we>e.replies_total-((null===(m=H[e.id])||void 0===m?void 0:m.page)||0)*we?e.replies_total-((null===(u=H[e.id])||void 0===u?void 0:u.page)||0)*we:we," \u6761\u56de\u590d")})})]})})})]})]},e.id)}))}),"article"===c?Q>we&&(0,d.jsx)(xe,{total:Q,page:H.page,getData:function(e){return Se({commentPage:e})}}):Q>3&&Te>0&&(0,d.jsx)("div",{className:"font-size-14 d-flex mt-3",children:(0,d.jsx)("a",{className:"text-secondary next-page-btn",href:"###",onClick:function(e){e.preventDefault(),ce?Se({commentPage:H.page+1}):le(!0)},children:Q<we?"\u5171 ".concat(Q," \u6761\u8bc4\u8bba"):"\u66f4\u591a ".concat(we>Te?Te:we," \u6761\u8bc4\u8bba")})})]})]}),(0,d.jsx)(y.yW,(0,r.Z)((0,a.Z)({},P),{setModalStatus:function(e){$((0,r.Z)((0,a.Z)({},P),{isShow:e}))}}))]})},_e=(0,d.jsx)(d.Fragment,{children:(0,d.jsx)(u(),{id:"264ee8e6dd3c886a",children:'.comment-wrap .media-body .fmt,.comment-wrap .media-body .fmt>p:first-child{display:inline}.comment-wrap .media-body .fmt>p:first-child::after{display:block;content:"";margin-bottom:1.25rem}.comment-wrap .media-body .fmt>p:last-child::after{display:none!important}.comment-wrap .commentUnit:hover .control-area,.comment-wrap .commentUnit:hover .comment-control-area{display:block!important}.comment-wrap .comment-reply{overflow:hidden;overflow-wrap:break-word;resize:none}.comment-wrap .dropdown-item.active,.comment-wrap .dropdown-item:active{background:#f8f9fa!important;color:inherit!important}.comment-wrap .reply-list .list-group-item{background-color:unset}'})}),Se=function(e){return(0,d.jsxs)(d.Fragment,{children:[_e,(0,d.jsx)(ke,(0,a.Z)({},e))]})},Ee=(0,g.$j)((function(e){return{sessionUser:e.global.sessionUser}}))(f.memo(Se))}}]);