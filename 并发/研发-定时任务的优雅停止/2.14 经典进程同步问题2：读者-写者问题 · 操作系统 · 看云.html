<!DOCTYPE html>
<!-- saved from url=(0046)https://www.kancloud.cn/hanghanghang/os/239539 -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
<title>2.14 经典进程同步问题2：读者-写者问题 · 操作系统 · 看云</title>
    <meta name="description" content="看云是一个现代化文档写作、托管及数字出版平台，基于MarkDown语法和Git版本库管理，让你专注于知识创作，可以用于企业知识库、产品手册、项目文档和个人数字出版。">
    <meta name="keywords" content="操作系统">
            <meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" data-react-helmet="true">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
                                
<script src="./2.14 经典进程同步问题2：读者-写者问题 · 操作系统 · 看云_files/index.js.下载" async="" data-plugin-name="highlight"></script><script src="./2.14 经典进程同步问题2：读者-写者问题 · 操作系统 · 看云_files/index.js(1).下载" async="" data-plugin-name="theme-default"></script><link rel="stylesheet" href="./2.14 经典进程同步问题2：读者-写者问题 · 操作系统 · 看云_files/style.css"><style type="text/css" data-react-helmet="true">.ಠhighlight-container code[class*=language-],.ಠhighlight-container pre[class*=language-]{color:#000;background:none;text-shadow:0 1px #fff;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}.ಠhighlight-container code[class*=language-]::-moz-selection,.ಠhighlight-container code[class*=language-] ::-moz-selection,.ಠhighlight-container pre[class*=language-]::-moz-selection,.ಠhighlight-container pre[class*=language-] ::-moz-selection{text-shadow:none;background:#b3d4fc}.ಠhighlight-container code[class*=language-]::selection,.ಠhighlight-container code[class*=language-] ::selection,.ಠhighlight-container pre[class*=language-]::selection,.ಠhighlight-container pre[class*=language-] ::selection{text-shadow:none;background:#b3d4fc}@media print{.ಠhighlight-container code[class*=language-],.ಠhighlight-container pre[class*=language-]{text-shadow:none}}.ಠhighlight-container pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}.ಠhighlight-container :not(pre)>code[class*=language-],.ಠhighlight-container pre[class*=language-]{background:#f5f2f0}.ಠhighlight-container :not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.ಠhighlight-container .token.cdata,.ಠhighlight-container .token.comment,.ಠhighlight-container .token.doctype,.ಠhighlight-container .token.prolog{color:#708090}.ಠhighlight-container .token.punctuation{color:#999}.ಠhighlight-container .namespace{opacity:.7}.ಠhighlight-container .token.boolean,.ಠhighlight-container .token.constant,.ಠhighlight-container .token.deleted,.ಠhighlight-container .token.number,.ಠhighlight-container .token.property,.ಠhighlight-container .token.symbol,.ಠhighlight-container .token.tag{color:#905}.ಠhighlight-container .token.attr-name,.ಠhighlight-container .token.builtin,.ಠhighlight-container .token.char,.ಠhighlight-container .token.inserted,.ಠhighlight-container .token.selector,.ಠhighlight-container .token.string{color:#690}.ಠhighlight-container .language-css .token.string,.ಠhighlight-container .style .token.string,.ಠhighlight-container .token.entity,.ಠhighlight-container .token.operator,.ಠhighlight-container .token.url{color:#9a6e3a;background:hsla(0,0%,100%,.5)}.ಠhighlight-container .token.atrule,.ಠhighlight-container .token.attr-value,.ಠhighlight-container .token.keyword{color:#07a}.ಠhighlight-container .token.class-name,.ಠhighlight-container .token.function{color:#dd4a68}.ಠhighlight-container .token.important,.ಠhighlight-container .token.regex,.ಠhighlight-container .token.variable{color:#e90}.ಠhighlight-container .token.bold,.ಠhighlight-container .token.important{font-weight:700}.ಠhighlight-container .token.italic{font-style:italic}.ಠhighlight-container .token.entity{cursor:help}</style></head>
<body>
<div id="main"><div class="window-container"><img src="./2.14 经典进程同步问题2：读者-写者问题 · 操作系统 · 看云_files/cover_2016-02-16_56c2a2f33bfa_800x1068.jpg-bookmiddle" style="position: absolute; visibility: hidden;"><div><div class="Loading__loading___1m_fZ"><div class="Loading__bar___21yOt" style="background: rgb(33, 186, 69); width: 0%; display: none;"><div class="Loading__peg___3Y_28"></div></div></div><div class="Loading__spinner___11Pm4"><div class="Loading__icon___3OOyu" style="display: none; border-color: rgb(33, 186, 69);"></div></div></div><div class="window-body with-sidebar"><div class="sidebar"><div class="sidebar-header"><a href="https://www.kancloud.cn/hanghanghang/os" data-no-pjax="true" class="title">操作系统</a><div class="search-form"><div class="ui small fluid icon input"><input type="text" placeholder="请输入搜索关键词..."><i class="icon search"></i></div></div></div><div class="sidebar-body"><div class="catalog-body"><ul><li class=""><div class="wholerow"></div><i class="icon"></i><a href="https://www.kancloud.cn/hanghanghang/os/116695" class="text">1. 操作系统概述</a></li><li class="open"><div class="wholerow"></div><i class="icon caret down"></i><a href="https://www.kancloud.cn/hanghanghang/os/116696" class="text">2.操作系统(计算机)进程和线程管理</a><ul><li class=""><div class="wholerow"></div><i class="icon"></i><a href="https://www.kancloud.cn/hanghanghang/os/116937" class="text">2.1 进程的概念和特征</a></li><li class=""><div class="wholerow"></div><i class="icon"></i><a href="https://www.kancloud.cn/hanghanghang/os/116938" class="text">2.2 进程的状态与转换</a></li><li class=""><div class="wholerow"></div><i class="icon"></i><a href="https://www.kancloud.cn/hanghanghang/os/116939" class="text">2.3 进程控制</a></li><li class=""><div class="wholerow"></div><i class="icon"></i><a href="https://www.kancloud.cn/hanghanghang/os/116940" class="text">2.4 进程的组</a></li><li class=""><div class="wholerow"></div><i class="icon"></i><a href="https://www.kancloud.cn/hanghanghang/os/116941" class="text">2.5 进程的通信</a></li><li class=""><div class="wholerow"></div><i class="icon"></i><a href="https://www.kancloud.cn/hanghanghang/os/116942" class="text">2.6 线程的概念和多线程模型</a></li><li class=""><div class="wholerow"></div><i class="icon"></i><a href="https://www.kancloud.cn/hanghanghang/os/116943" class="text">2.7 处理机调度</a></li><li class=""><div class="wholerow"></div><i class="icon"></i><a href="https://www.kancloud.cn/hanghanghang/os/116944" class="text">2.8 操作系统典型调度算法</a></li><li class=""><div class="wholerow"></div><i class="icon"></i><a href="https://www.kancloud.cn/hanghanghang/os/116760" class="text">2.9 进程同步的基本概念</a></li><li class=""><div class="wholerow"></div><i class="icon"></i><a href="https://www.kancloud.cn/hanghanghang/os/116761" class="text">2.10 实现临界区互斥的基本方法</a></li><li class=""><div class="wholerow"></div><i class="icon"></i><a href="https://www.kancloud.cn/hanghanghang/os/116945" class="text">2.11 信号量</a></li><li class=""><div class="wholerow"></div><i class="icon"></i><a href="https://www.kancloud.cn/hanghanghang/os/239537" class="text">2.12 管程：管程的定义、组成及基本特性</a></li><li class=""><div class="wholerow"></div><i class="icon"></i><a href="https://www.kancloud.cn/hanghanghang/os/239538" class="text">2.13 经典进程同步问题1</a></li><li class="active"><div class="wholerow"></div><i class="icon"></i><a href="https://www.kancloud.cn/hanghanghang/os/239539" class="text">2.14 经典进程同步问题2：读者-写者问题</a></li><li class=""><div class="wholerow"></div><i class="icon"></i><a href="https://www.kancloud.cn/hanghanghang/os/239540" class="text">2.15经典进程同步问题3：哲学家进餐问题</a></li><li class=""><div class="wholerow"></div><i class="icon"></i><a href="https://www.kancloud.cn/hanghanghang/os/239541" class="text">2.16 经典进程同步问题4：吸烟者问题</a></li><li class=""><div class="wholerow"></div><i class="icon"></i><a href="https://www.kancloud.cn/hanghanghang/os/239542" class="text">2.17 死锁的概念以及产生死锁的原因</a></li><li class=""><div class="wholerow"></div><i class="icon"></i><a href="https://www.kancloud.cn/hanghanghang/os/239543" class="text">2.18 关于进程和线程的知识点汇总</a></li></ul></li></ul></div></div><div class="sidebar-copyright">本文档使用 <a href="https://www.kancloud.cn/" target="_blank">看云</a> 构建</div></div><div class="workspace"><div class="article"><div class="article-head"><div class="left tools"><a class="item icon"><i class="icon align justify"></i></a></div><h1>2.14 经典进程同步问题2：读者-写者问题</h1><div class="right tools"><div role="listbox" aria-expanded="false" class="ui top right pointing dropdown item" tabindex="0"><div class="text" role="alert" aria-live="polite"></div><i aria-hidden="true" class="share alternate icon"></i><div class="menu transition"><div role="option" class="item"><i aria-hidden="true" class="linkify icon"></i><span class="text">复制链接</span></div><div role="option" class="item"><i aria-hidden="true" class="qq icon"></i><span class="text">腾讯QQ</span></div><div role="option" class="item"><i aria-hidden="true" class="weibo icon"></i><span class="text">新浪微博</span></div><div class="header"><p><i class="icon wechat"></i><span class="text">微信扫一扫</span></p><img src="./2.14 经典进程同步问题2：读者-写者问题 · 操作系统 · 看云_files/barCode"></div></div></div></div></div><div class="article-body kancloud-markdown-body"><h2><a id="_0"></a>问题描述</h2>
<p>有读者和写者两组并发进程，共享一个文件，当两个或以上的读进程同时访问共享数据时不会产生副作用，但若某个写进程和其他进程（读进程或写进程）同时访问共享数据时则可能导致数据不一致的错误。因此要求：①允许多个读者可以同时对文件执行读操作；②只允许一个写者往文件中写信息；③任一写者在完成写操作之前不允许其他读者或写者工作；④写者执行写操作前，应让已有的读者和写者全部退出。</p>
<h2><a id="_3"></a>问题分析</h2>
<ol><li><p>关系分析。由题目分析读者和写者是互斥的，写者和写者也是互斥的，而读者和读者不存在互斥问题。</p></li><li><p>整理思路。两个进程，即读者和写者。写者是比较简单的，它和任何进程互斥，用互斥信号量的P操作、V操作即可解决。读者的问题比较复杂，它必须实现与写者互斥的同时还要实现与其他读者的同步，因此，仅仅简单的一对P操作、V操作是无法解决的。那么，在这里用到了一个计数器，用它来判断当前是否有读者读文件。当有读者的时候写者是无法写文件的，此时读者会一直占用文件，当没有读者的时候写者才可以写文件。同时这里不同读者对计数器的访问也应该是互斥的。</p></li><li><p>信号量设置。首先设置信号量count为计数器，用来记录当前读者数量，初值为0; 设置mutex为互斥信号量，用于保护更新count变量时的互斥；设置互斥信号量rw用于保证读者和写者的互斥访问。</p></li></ol>
<p>代码如下：</p>
<pre><code class="ಠhighlight-container">int count<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>  <span class="token comment">//用于记录当前的读者数量</span>
semaphore mutex<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>  <span class="token comment">//用于保护更新count变量时的互斥</span>
semaphore rw<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>  <span class="token comment">//用于保证读者和写者互斥地访问文件</span>
writer <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">//写者进程</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">P</span><span class="token punctuation">(</span>rw<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 互斥访问共享文件</span>
        Writing<span class="token punctuation">;</span>  <span class="token comment">//写入</span>
        <span class="token function">V</span><span class="token punctuation">(</span>rw<span class="token punctuation">)</span> <span class="token punctuation">;</span>  <span class="token comment">//释放共享文件</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
reader <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">// 读者进程</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        P <span class="token punctuation">(</span>mutex<span class="token punctuation">)</span> <span class="token punctuation">;</span>  <span class="token comment">//互斥访问count变量</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>count<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span>  <span class="token comment">//当第一个读进程读共享文件时</span>
            <span class="token function">P</span><span class="token punctuation">(</span>rw<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//阻止写进程写</span>
        count<span class="token operator">++</span><span class="token punctuation">;</span>  <span class="token comment">//读者计数器加1</span>
        V <span class="token punctuation">(</span>mutex<span class="token punctuation">)</span> <span class="token punctuation">;</span>  <span class="token comment">//释放互斥变量count</span>
        reading<span class="token punctuation">;</span>  <span class="token comment">//读取</span>
        P <span class="token punctuation">(</span>mutex<span class="token punctuation">)</span> <span class="token punctuation">;</span>  <span class="token comment">//互斥访问count变量</span>
        count<span class="token operator">--</span><span class="token punctuation">;</span> <span class="token comment">//读者计数器减1</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>count<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span>  <span class="token comment">//当最后一个读进程读完共享文件</span>
            <span class="token function">V</span><span class="token punctuation">(</span>rw<span class="token punctuation">)</span> <span class="token punctuation">;</span>  <span class="token comment">//允许写进程写</span>
        V <span class="token punctuation">(</span>mutex<span class="token punctuation">)</span> <span class="token punctuation">;</span>  <span class="token comment">//释放互斥变量 count</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>在上面的算法中，读进程是优先的，也就是说，当存在读进程时，写操作将被延迟，并且只要有一个读进程活跃，随后而来的读进程都将被允许访问文件。这样的方式下，会导致写进程可能长时间等待，且存在写进程“饿死”的情况。</p>
<p>如果希望写进程优先，即当有读进程正在读共享文件时，有写进程请求访问，这时应禁止后续读进程的请求，等待到已在共享文件的读进程执行完毕则立即让写进程执行，只有在无写进程执行的情况下才允许读进程再次运行。为此，增加一个信号量并且在上面的程序中 writer()和reader()函数中各增加一对PV操作，就可以得到写进程优先的解决程序。</p>
<pre><code class="ಠhighlight-container">int count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token comment">//用于记录当前的读者数量</span>
semaphore mutex <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>  <span class="token comment">//用于保护更新count变量时的互斥</span>
semaphore rw<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>  <span class="token comment">//用于保证读者和写者互斥地访问文件</span>
semaphore w<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>  <span class="token comment">//用于实现“写优先”</span>
<span class="token function">writer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">P</span><span class="token punctuation">(</span>w<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//在无写进程请求时进入</span>
        <span class="token function">P</span><span class="token punctuation">(</span>rw<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//互斥访问共享文件</span>
        writing<span class="token punctuation">;</span>  <span class="token comment">//写入</span>
        <span class="token function">V</span><span class="token punctuation">(</span>rw<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 释放共享文件</span>
        <span class="token function">V</span><span class="token punctuation">(</span>w<span class="token punctuation">)</span> <span class="token punctuation">;</span>  <span class="token comment">//恢复对共享支件的访问</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
reader <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">//读者进程</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        P <span class="token punctuation">(</span>w<span class="token punctuation">)</span> <span class="token punctuation">;</span>  <span class="token comment">// 在无写进程请求时进入</span>
        P <span class="token punctuation">(</span>mutex<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 互斥访问count变量</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>count<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span>  <span class="token comment">//当第一个读进程读共享文件时</span>
            <span class="token function">P</span><span class="token punctuation">(</span>rw<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//阻止写进程写</span>
        count<span class="token operator">++</span><span class="token punctuation">;</span>  <span class="token comment">//读者计数器加1</span>
        V <span class="token punctuation">(</span>mutex<span class="token punctuation">)</span> <span class="token punctuation">;</span>  <span class="token comment">//释放互斥变量count</span>
        <span class="token function">V</span><span class="token punctuation">(</span>w<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//恢复对共享文件的访问</span>
        reading<span class="token punctuation">;</span>  <span class="token comment">//读取</span>
        P <span class="token punctuation">(</span>mutex<span class="token punctuation">)</span> <span class="token punctuation">;</span> <span class="token comment">//互斥访问count变量</span>
        count<span class="token operator">--</span><span class="token punctuation">;</span>  <span class="token comment">//读者计数器减1</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>count<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span>  <span class="token comment">//当最后一个读进程读完共享文件</span>
            <span class="token function">V</span><span class="token punctuation">(</span>rw<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//允许写进程写</span>
        V <span class="token punctuation">(</span>mutex<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//释放互斥变量count</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
</div><div class="article-navigation"><span class="prev">上一篇：<a href="https://www.kancloud.cn/hanghanghang/os/239538">2.13 经典进程同步问题1</a></span><span class="next">下一篇：<a href="https://www.kancloud.cn/hanghanghang/os/239540">2.15经典进程同步问题3：哲学家进餐问题</a></span></div><div class="article-foot"></div></div></div></div></div></div>
<script type="application/payload+json">
    {
        "config":{"plugins":["highlight"],"title":"\u64cd\u4f5c\u7cfb\u7edf","description":"","cover":"https:\/\/box.kancloud.cn\/cover_2016-02-16_56c2a2f33bfa_800x1068.jpg-bookmiddle","author":{"name":"hangweiping","email":"136151148@qq.com","url":"https:\/\/www.kancloud.cn\/@hanghanghang"}},
        "options":{"book":{"id":13046,"title":"\u64cd\u4f5c\u7cfb\u7edf","namespace":"hanghanghang","name":"os","price":0,"cover":"https:\/\/box.kancloud.cn\/cover_2016-02-16_56c2a2f33bfa_800x1068.jpg","middle_cover":"https:\/\/box.kancloud.cn\/cover_2016-02-16_56c2a2f33bfa_800x1068.jpg-bookmiddle","small_cover":"https:\/\/box.kancloud.cn\/cover_2016-02-16_56c2a2f33bfa_800x1068.jpg-booksmall"},"plugins":{"host":"plugins.kancloud.cn","scheme":"https"},"web":{"host":"www.kancloud.cn","scheme":"https"},"environment":"reader","base":"\/hanghanghang\/os\/content","entry":"\/hanghanghang\/os"},
        "style": "",
        "article":{"path":"239539","ref":"2.14 \u7ecf\u5178\u8fdb\u7a0b\u540c\u6b65\u95ee\u98982\uff1a\u8bfb\u8005-\u5199\u8005\u95ee\u9898.md","title":"2.14 \u7ecf\u5178\u8fdb\u7a0b\u540c\u6b65\u95ee\u98982\uff1a\u8bfb\u8005-\u5199\u8005\u95ee\u9898","content":"## \u95ee\u9898\u63cf\u8ff0\n\n\u6709\u8bfb\u8005\u548c\u5199\u8005\u4e24\u7ec4\u5e76\u53d1\u8fdb\u7a0b\uff0c\u5171\u4eab\u4e00\u4e2a\u6587\u4ef6\uff0c\u5f53\u4e24\u4e2a\u6216\u4ee5\u4e0a\u7684\u8bfb\u8fdb\u7a0b\u540c\u65f6\u8bbf\u95ee\u5171\u4eab\u6570\u636e\u65f6\u4e0d\u4f1a\u4ea7\u751f\u526f\u4f5c\u7528\uff0c\u4f46\u82e5\u67d0\u4e2a\u5199\u8fdb\u7a0b\u548c\u5176\u4ed6\u8fdb\u7a0b\uff08\u8bfb\u8fdb\u7a0b\u6216\u5199\u8fdb\u7a0b\uff09\u540c\u65f6\u8bbf\u95ee\u5171\u4eab\u6570\u636e\u65f6\u5219\u53ef\u80fd\u5bfc\u81f4\u6570\u636e\u4e0d\u4e00\u81f4\u7684\u9519\u8bef\u3002\u56e0\u6b64\u8981\u6c42\uff1a\u2460\u5141\u8bb8\u591a\u4e2a\u8bfb\u8005\u53ef\u4ee5\u540c\u65f6\u5bf9\u6587\u4ef6\u6267\u884c\u8bfb\u64cd\u4f5c\uff1b\u2461\u53ea\u5141\u8bb8\u4e00\u4e2a\u5199\u8005\u5f80\u6587\u4ef6\u4e2d\u5199\u4fe1\u606f\uff1b\u2462\u4efb\u4e00\u5199\u8005\u5728\u5b8c\u6210\u5199\u64cd\u4f5c\u4e4b\u524d\u4e0d\u5141\u8bb8\u5176\u4ed6\u8bfb\u8005\u6216\u5199\u8005\u5de5\u4f5c\uff1b\u2463\u5199\u8005\u6267\u884c\u5199\u64cd\u4f5c\u524d\uff0c\u5e94\u8ba9\u5df2\u6709\u7684\u8bfb\u8005\u548c\u5199\u8005\u5168\u90e8\u9000\u51fa\u3002\n## \u95ee\u9898\u5206\u6790\n\n1) \u5173\u7cfb\u5206\u6790\u3002\u7531\u9898\u76ee\u5206\u6790\u8bfb\u8005\u548c\u5199\u8005\u662f\u4e92\u65a5\u7684\uff0c\u5199\u8005\u548c\u5199\u8005\u4e5f\u662f\u4e92\u65a5\u7684\uff0c\u800c\u8bfb\u8005\u548c\u8bfb\u8005\u4e0d\u5b58\u5728\u4e92\u65a5\u95ee\u9898\u3002\n\n2) \u6574\u7406\u601d\u8def\u3002\u4e24\u4e2a\u8fdb\u7a0b\uff0c\u5373\u8bfb\u8005\u548c\u5199\u8005\u3002\u5199\u8005\u662f\u6bd4\u8f83\u7b80\u5355\u7684\uff0c\u5b83\u548c\u4efb\u4f55\u8fdb\u7a0b\u4e92\u65a5\uff0c\u7528\u4e92\u65a5\u4fe1\u53f7\u91cf\u7684P\u64cd\u4f5c\u3001V\u64cd\u4f5c\u5373\u53ef\u89e3\u51b3\u3002\u8bfb\u8005\u7684\u95ee\u9898\u6bd4\u8f83\u590d\u6742\uff0c\u5b83\u5fc5\u987b\u5b9e\u73b0\u4e0e\u5199\u8005\u4e92\u65a5\u7684\u540c\u65f6\u8fd8\u8981\u5b9e\u73b0\u4e0e\u5176\u4ed6\u8bfb\u8005\u7684\u540c\u6b65\uff0c\u56e0\u6b64\uff0c\u4ec5\u4ec5\u7b80\u5355\u7684\u4e00\u5bf9P\u64cd\u4f5c\u3001V\u64cd\u4f5c\u662f\u65e0\u6cd5\u89e3\u51b3\u7684\u3002\u90a3\u4e48\uff0c\u5728\u8fd9\u91cc\u7528\u5230\u4e86\u4e00\u4e2a\u8ba1\u6570\u5668\uff0c\u7528\u5b83\u6765\u5224\u65ad\u5f53\u524d\u662f\u5426\u6709\u8bfb\u8005\u8bfb\u6587\u4ef6\u3002\u5f53\u6709\u8bfb\u8005\u7684\u65f6\u5019\u5199\u8005\u662f\u65e0\u6cd5\u5199\u6587\u4ef6\u7684\uff0c\u6b64\u65f6\u8bfb\u8005\u4f1a\u4e00\u76f4\u5360\u7528\u6587\u4ef6\uff0c\u5f53\u6ca1\u6709\u8bfb\u8005\u7684\u65f6\u5019\u5199\u8005\u624d\u53ef\u4ee5\u5199\u6587\u4ef6\u3002\u540c\u65f6\u8fd9\u91cc\u4e0d\u540c\u8bfb\u8005\u5bf9\u8ba1\u6570\u5668\u7684\u8bbf\u95ee\u4e5f\u5e94\u8be5\u662f\u4e92\u65a5\u7684\u3002\n\n3) \u4fe1\u53f7\u91cf\u8bbe\u7f6e\u3002\u9996\u5148\u8bbe\u7f6e\u4fe1\u53f7\u91cfcount\u4e3a\u8ba1\u6570\u5668\uff0c\u7528\u6765\u8bb0\u5f55\u5f53\u524d\u8bfb\u8005\u6570\u91cf\uff0c\u521d\u503c\u4e3a0; \u8bbe\u7f6emutex\u4e3a\u4e92\u65a5\u4fe1\u53f7\u91cf\uff0c\u7528\u4e8e\u4fdd\u62a4\u66f4\u65b0count\u53d8\u91cf\u65f6\u7684\u4e92\u65a5\uff1b\u8bbe\u7f6e\u4e92\u65a5\u4fe1\u53f7\u91cfrw\u7528\u4e8e\u4fdd\u8bc1\u8bfb\u8005\u548c\u5199\u8005\u7684\u4e92\u65a5\u8bbf\u95ee\u3002\n\n\u4ee3\u7801\u5982\u4e0b\uff1a\n```\nint count=0;  \/\/\u7528\u4e8e\u8bb0\u5f55\u5f53\u524d\u7684\u8bfb\u8005\u6570\u91cf\nsemaphore mutex=1;  \/\/\u7528\u4e8e\u4fdd\u62a4\u66f4\u65b0count\u53d8\u91cf\u65f6\u7684\u4e92\u65a5\nsemaphore rw=1;  \/\/\u7528\u4e8e\u4fdd\u8bc1\u8bfb\u8005\u548c\u5199\u8005\u4e92\u65a5\u5730\u8bbf\u95ee\u6587\u4ef6\nwriter () {  \/\/\u5199\u8005\u8fdb\u7a0b\n    while (1){\n        P(rw); \/\/ \u4e92\u65a5\u8bbf\u95ee\u5171\u4eab\u6587\u4ef6\n        Writing;  \/\/\u5199\u5165\n        V(rw) ;  \/\/\u91ca\u653e\u5171\u4eab\u6587\u4ef6\n    }\n}\nreader () {  \/\/ \u8bfb\u8005\u8fdb\u7a0b\n    while(1){\n        P (mutex) ;  \/\/\u4e92\u65a5\u8bbf\u95eecount\u53d8\u91cf\n        if (count==0)  \/\/\u5f53\u7b2c\u4e00\u4e2a\u8bfb\u8fdb\u7a0b\u8bfb\u5171\u4eab\u6587\u4ef6\u65f6\n            P(rw);  \/\/\u963b\u6b62\u5199\u8fdb\u7a0b\u5199\n        count++;  \/\/\u8bfb\u8005\u8ba1\u6570\u5668\u52a01\n        V (mutex) ;  \/\/\u91ca\u653e\u4e92\u65a5\u53d8\u91cfcount\n        reading;  \/\/\u8bfb\u53d6\n        P (mutex) ;  \/\/\u4e92\u65a5\u8bbf\u95eecount\u53d8\u91cf\n        count--; \/\/\u8bfb\u8005\u8ba1\u6570\u5668\u51cf1\n        if (count==0)  \/\/\u5f53\u6700\u540e\u4e00\u4e2a\u8bfb\u8fdb\u7a0b\u8bfb\u5b8c\u5171\u4eab\u6587\u4ef6\n            V(rw) ;  \/\/\u5141\u8bb8\u5199\u8fdb\u7a0b\u5199\n        V (mutex) ;  \/\/\u91ca\u653e\u4e92\u65a5\u53d8\u91cf count\n    }\n}\n```\n\u5728\u4e0a\u9762\u7684\u7b97\u6cd5\u4e2d\uff0c\u8bfb\u8fdb\u7a0b\u662f\u4f18\u5148\u7684\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u5f53\u5b58\u5728\u8bfb\u8fdb\u7a0b\u65f6\uff0c\u5199\u64cd\u4f5c\u5c06\u88ab\u5ef6\u8fdf\uff0c\u5e76\u4e14\u53ea\u8981\u6709\u4e00\u4e2a\u8bfb\u8fdb\u7a0b\u6d3b\u8dc3\uff0c\u968f\u540e\u800c\u6765\u7684\u8bfb\u8fdb\u7a0b\u90fd\u5c06\u88ab\u5141\u8bb8\u8bbf\u95ee\u6587\u4ef6\u3002\u8fd9\u6837\u7684\u65b9\u5f0f\u4e0b\uff0c\u4f1a\u5bfc\u81f4\u5199\u8fdb\u7a0b\u53ef\u80fd\u957f\u65f6\u95f4\u7b49\u5f85\uff0c\u4e14\u5b58\u5728\u5199\u8fdb\u7a0b\u201c\u997f\u6b7b\u201d\u7684\u60c5\u51b5\u3002\n\n\u5982\u679c\u5e0c\u671b\u5199\u8fdb\u7a0b\u4f18\u5148\uff0c\u5373\u5f53\u6709\u8bfb\u8fdb\u7a0b\u6b63\u5728\u8bfb\u5171\u4eab\u6587\u4ef6\u65f6\uff0c\u6709\u5199\u8fdb\u7a0b\u8bf7\u6c42\u8bbf\u95ee\uff0c\u8fd9\u65f6\u5e94\u7981\u6b62\u540e\u7eed\u8bfb\u8fdb\u7a0b\u7684\u8bf7\u6c42\uff0c\u7b49\u5f85\u5230\u5df2\u5728\u5171\u4eab\u6587\u4ef6\u7684\u8bfb\u8fdb\u7a0b\u6267\u884c\u5b8c\u6bd5\u5219\u7acb\u5373\u8ba9\u5199\u8fdb\u7a0b\u6267\u884c\uff0c\u53ea\u6709\u5728\u65e0\u5199\u8fdb\u7a0b\u6267\u884c\u7684\u60c5\u51b5\u4e0b\u624d\u5141\u8bb8\u8bfb\u8fdb\u7a0b\u518d\u6b21\u8fd0\u884c\u3002\u4e3a\u6b64\uff0c\u589e\u52a0\u4e00\u4e2a\u4fe1\u53f7\u91cf\u5e76\u4e14\u5728\u4e0a\u9762\u7684\u7a0b\u5e8f\u4e2d writer()\u548creader()\u51fd\u6570\u4e2d\u5404\u589e\u52a0\u4e00\u5bf9PV\u64cd\u4f5c\uff0c\u5c31\u53ef\u4ee5\u5f97\u5230\u5199\u8fdb\u7a0b\u4f18\u5148\u7684\u89e3\u51b3\u7a0b\u5e8f\u3002\n\n```\nint count = 0;  \/\/\u7528\u4e8e\u8bb0\u5f55\u5f53\u524d\u7684\u8bfb\u8005\u6570\u91cf\nsemaphore mutex = 1;  \/\/\u7528\u4e8e\u4fdd\u62a4\u66f4\u65b0count\u53d8\u91cf\u65f6\u7684\u4e92\u65a5\nsemaphore rw=1;  \/\/\u7528\u4e8e\u4fdd\u8bc1\u8bfb\u8005\u548c\u5199\u8005\u4e92\u65a5\u5730\u8bbf\u95ee\u6587\u4ef6\nsemaphore w=1;  \/\/\u7528\u4e8e\u5b9e\u73b0\u201c\u5199\u4f18\u5148\u201d\nwriter(){\n    while(1){\n        P(w);  \/\/\u5728\u65e0\u5199\u8fdb\u7a0b\u8bf7\u6c42\u65f6\u8fdb\u5165\n        P(rw);  \/\/\u4e92\u65a5\u8bbf\u95ee\u5171\u4eab\u6587\u4ef6\n        writing;  \/\/\u5199\u5165\n        V(rw);  \/\/ \u91ca\u653e\u5171\u4eab\u6587\u4ef6\n        V(w) ;  \/\/\u6062\u590d\u5bf9\u5171\u4eab\u652f\u4ef6\u7684\u8bbf\u95ee\n    }\n}\nreader () {  \/\/\u8bfb\u8005\u8fdb\u7a0b\n    while (1){\n        P (w) ;  \/\/ \u5728\u65e0\u5199\u8fdb\u7a0b\u8bf7\u6c42\u65f6\u8fdb\u5165\n        P (mutex);  \/\/ \u4e92\u65a5\u8bbf\u95eecount\u53d8\u91cf\n        if (count==0)  \/\/\u5f53\u7b2c\u4e00\u4e2a\u8bfb\u8fdb\u7a0b\u8bfb\u5171\u4eab\u6587\u4ef6\u65f6\n            P(rw);  \/\/\u963b\u6b62\u5199\u8fdb\u7a0b\u5199\n        count++;  \/\/\u8bfb\u8005\u8ba1\u6570\u5668\u52a01\n        V (mutex) ;  \/\/\u91ca\u653e\u4e92\u65a5\u53d8\u91cfcount\n        V(w);  \/\/\u6062\u590d\u5bf9\u5171\u4eab\u6587\u4ef6\u7684\u8bbf\u95ee\n        reading;  \/\/\u8bfb\u53d6\n        P (mutex) ; \/\/\u4e92\u65a5\u8bbf\u95eecount\u53d8\u91cf\n        count--;  \/\/\u8bfb\u8005\u8ba1\u6570\u5668\u51cf1\n        if (count==0)  \/\/\u5f53\u6700\u540e\u4e00\u4e2a\u8bfb\u8fdb\u7a0b\u8bfb\u5b8c\u5171\u4eab\u6587\u4ef6\n            V(rw);  \/\/\u5141\u8bb8\u5199\u8fdb\u7a0b\u5199\n        V (mutex);  \/\/\u91ca\u653e\u4e92\u65a5\u53d8\u91cfcount\n    }\n}\n```"},
        "summary":[{"id":116695,"pid":0,"name":"default.md","title":"1. \u64cd\u4f5c\u7cfb\u7edf\u6982\u8ff0","is_probation":0,"ref":"default.md","path":"116695","index":0},{"id":116696,"pid":0,"name":"chapter2.md","title":"2.\u64cd\u4f5c\u7cfb\u7edf(\u8ba1\u7b97\u673a)\u8fdb\u7a0b\u548c\u7ebf\u7a0b\u7ba1\u7406","is_probation":0,"ref":"chapter2.md","path":"116696","index":1,"articles":[{"id":116937,"pid":116696,"name":"2.1\u8fdb\u7a0b\u7684\u6982\u5ff5\u548c\u7279\u5f81.md","title":"2.1 \u8fdb\u7a0b\u7684\u6982\u5ff5\u548c\u7279\u5f81","is_probation":0,"ref":"2.1\u8fdb\u7a0b\u7684\u6982\u5ff5\u548c\u7279\u5f81.md","path":"116937","index":2},{"id":116938,"pid":116696,"name":"2.2\u8fdb\u7a0b\u7684\u72b6\u6001\u4e0e\u8f6c\u6362.md","title":"2.2 \u8fdb\u7a0b\u7684\u72b6\u6001\u4e0e\u8f6c\u6362","is_probation":0,"ref":"2.2\u8fdb\u7a0b\u7684\u72b6\u6001\u4e0e\u8f6c\u6362.md","path":"116938","index":3},{"id":116939,"pid":116696,"name":"2.3\u8fdb\u7a0b\u63a7\u5236.md","title":"2.3 \u8fdb\u7a0b\u63a7\u5236","is_probation":0,"ref":"2.3\u8fdb\u7a0b\u63a7\u5236.md","path":"116939","index":4},{"id":116940,"pid":116696,"name":"2.4\u8fdb\u7a0b\u7684\u7ec4.md","title":"2.4 \u8fdb\u7a0b\u7684\u7ec4","is_probation":0,"ref":"2.4\u8fdb\u7a0b\u7684\u7ec4.md","path":"116940","index":5},{"id":116941,"pid":116696,"name":"2.5\u8fdb\u7a0b\u7684\u901a\u4fe1.md","title":"2.5 \u8fdb\u7a0b\u7684\u901a\u4fe1","is_probation":0,"ref":"2.5\u8fdb\u7a0b\u7684\u901a\u4fe1.md","path":"116941","index":6},{"id":116942,"pid":116696,"name":"2.6\u7ebf\u7a0b\u7684\u6982\u5ff5\u548c\u591a\u7ebf\u7a0b\u6a21\u578b.md","title":"2.6 \u7ebf\u7a0b\u7684\u6982\u5ff5\u548c\u591a\u7ebf\u7a0b\u6a21\u578b","is_probation":0,"ref":"2.6\u7ebf\u7a0b\u7684\u6982\u5ff5\u548c\u591a\u7ebf\u7a0b\u6a21\u578b.md","path":"116942","index":7},{"id":116943,"pid":116696,"name":"2.7\u5904\u7406\u673a\u8c03\u5ea6.md","title":"2.7 \u5904\u7406\u673a\u8c03\u5ea6","is_probation":0,"ref":"2.7\u5904\u7406\u673a\u8c03\u5ea6.md","path":"116943","index":8},{"id":116944,"pid":116696,"name":"2.8\u64cd\u4f5c\u7cfb\u7edf\u5178\u578b\u8c03\u5ea6\u7b97\u6cd5.md","title":"2.8 \u64cd\u4f5c\u7cfb\u7edf\u5178\u578b\u8c03\u5ea6\u7b97\u6cd5","is_probation":0,"ref":"2.8\u64cd\u4f5c\u7cfb\u7edf\u5178\u578b\u8c03\u5ea6\u7b97\u6cd5.md","path":"116944","index":9},{"id":116760,"pid":116696,"name":"2.9\u8fdb\u7a0b\u540c\u6b65\u7684\u57fa\u672c\u6982\u5ff5.md","title":"2.9 \u8fdb\u7a0b\u540c\u6b65\u7684\u57fa\u672c\u6982\u5ff5","is_probation":0,"ref":"2.9\u8fdb\u7a0b\u540c\u6b65\u7684\u57fa\u672c\u6982\u5ff5.md","path":"116760","index":10},{"id":116761,"pid":116696,"name":"2.10\u5b9e\u73b0\u4e34\u754c\u533a\u4e92\u65a5\u7684\u57fa\u672c\u65b9\u6cd5.md","title":"2.10 \u5b9e\u73b0\u4e34\u754c\u533a\u4e92\u65a5\u7684\u57fa\u672c\u65b9\u6cd5","is_probation":0,"ref":"2.10\u5b9e\u73b0\u4e34\u754c\u533a\u4e92\u65a5\u7684\u57fa\u672c\u65b9\u6cd5.md","path":"116761","index":11},{"id":116945,"pid":116696,"name":"2.11\u4fe1\u53f7\u91cf.md","title":"2.11 \u4fe1\u53f7\u91cf","is_probation":0,"ref":"2.11\u4fe1\u53f7\u91cf.md","path":"116945","index":12},{"id":239537,"pid":116696,"name":"2.12 \u7ba1\u7a0b\uff1a\u7ba1\u7a0b\u7684\u5b9a\u4e49\u3001\u7ec4\u6210\u53ca\u57fa\u672c\u7279\u6027.md","title":"2.12 \u7ba1\u7a0b\uff1a\u7ba1\u7a0b\u7684\u5b9a\u4e49\u3001\u7ec4\u6210\u53ca\u57fa\u672c\u7279\u6027","is_probation":0,"ref":"2.12 \u7ba1\u7a0b\uff1a\u7ba1\u7a0b\u7684\u5b9a\u4e49\u3001\u7ec4\u6210\u53ca\u57fa\u672c\u7279\u6027.md","path":"239537","index":13},{"id":239538,"pid":116696,"name":"2.13\u7ecf\u5178\u8fdb\u7a0b\u540c\u6b65\u95ee\u98981.md","title":"2.13 \u7ecf\u5178\u8fdb\u7a0b\u540c\u6b65\u95ee\u98981","is_probation":0,"ref":"2.13\u7ecf\u5178\u8fdb\u7a0b\u540c\u6b65\u95ee\u98981.md","path":"239538","index":14},{"id":239539,"pid":116696,"name":"2.14 \u7ecf\u5178\u8fdb\u7a0b\u540c\u6b65\u95ee\u98982\uff1a\u8bfb\u8005-\u5199\u8005\u95ee\u9898.md","title":"2.14 \u7ecf\u5178\u8fdb\u7a0b\u540c\u6b65\u95ee\u98982\uff1a\u8bfb\u8005-\u5199\u8005\u95ee\u9898","is_probation":0,"ref":"2.14 \u7ecf\u5178\u8fdb\u7a0b\u540c\u6b65\u95ee\u98982\uff1a\u8bfb\u8005-\u5199\u8005\u95ee\u9898.md","path":"239539","index":15},{"id":239540,"pid":116696,"name":"2.15\u7ecf\u5178\u8fdb\u7a0b\u540c\u6b65\u95ee\u98983\uff1a\u54f2\u5b66\u5bb6\u8fdb\u9910\u95ee\u9898.md","title":"2.15\u7ecf\u5178\u8fdb\u7a0b\u540c\u6b65\u95ee\u98983\uff1a\u54f2\u5b66\u5bb6\u8fdb\u9910\u95ee\u9898","is_probation":0,"ref":"2.15\u7ecf\u5178\u8fdb\u7a0b\u540c\u6b65\u95ee\u98983\uff1a\u54f2\u5b66\u5bb6\u8fdb\u9910\u95ee\u9898.md","path":"239540","index":16},{"id":239541,"pid":116696,"name":"2.16 \u7ecf\u5178\u8fdb\u7a0b\u540c\u6b65\u95ee\u98984\uff1a\u5438\u70df\u8005\u95ee\u9898.md","title":"2.16 \u7ecf\u5178\u8fdb\u7a0b\u540c\u6b65\u95ee\u98984\uff1a\u5438\u70df\u8005\u95ee\u9898","is_probation":0,"ref":"2.16 \u7ecf\u5178\u8fdb\u7a0b\u540c\u6b65\u95ee\u98984\uff1a\u5438\u70df\u8005\u95ee\u9898.md","path":"239541","index":17},{"id":239542,"pid":116696,"name":"2.17 \u6b7b\u9501\u7684\u6982\u5ff5\u4ee5\u53ca\u4ea7\u751f\u6b7b\u9501\u7684\u539f\u56e0.md","title":"2.17 \u6b7b\u9501\u7684\u6982\u5ff5\u4ee5\u53ca\u4ea7\u751f\u6b7b\u9501\u7684\u539f\u56e0","is_probation":0,"ref":"2.17 \u6b7b\u9501\u7684\u6982\u5ff5\u4ee5\u53ca\u4ea7\u751f\u6b7b\u9501\u7684\u539f\u56e0.md","path":"239542","index":18},{"id":239543,"pid":116696,"name":"2.18 \u5173\u4e8e\u8fdb\u7a0b\u548c\u7ebf\u7a0b\u7684\u77e5\u8bc6\u70b9\u6c47\u603b.md","title":"2.18 \u5173\u4e8e\u8fdb\u7a0b\u548c\u7ebf\u7a0b\u7684\u77e5\u8bc6\u70b9\u6c47\u603b","is_probation":0,"ref":"2.18 \u5173\u4e8e\u8fdb\u7a0b\u548c\u7ebf\u7a0b\u7684\u77e5\u8bc6\u70b9\u6c47\u603b.md","path":"239543","index":19}]}]
    }
</script>
<script type="text/javascript" src="./2.14 经典进程同步问题2：读者-写者问题 · 操作系统 · 看云_files/reader.js.下载"></script>
<script type="text/javascript">
        if (self === top) {
        kancloud.bootstrap();
    }
    </script>
    <!-- Google Analytics -->
    <script>
        window.ga = window.ga || function () {
            (ga.q = ga.q || []).push(arguments)
        };
        ga.l      = +new Date;
        ga('create', 'UA-85687835-1', 'auto', 'web');
        ga('set', 'transport', 'beacon');
        
                ga('web.send', 'pageview', {
            dimension1:13046
        });
        window.sendPageView = function (page, title) {
            ga('web.set', 'page', page);
            ga('web.set', 'title', title);
            ga('web.send', 'pageview', {
                dimension1: 13046
            });
        }
            </script>
    <script async="" src="./2.14 经典进程同步问题2：读者-写者问题 · 操作系统 · 看云_files/analytics.js.下载"></script>
    <!-- End Google Analytics -->


</body></html>